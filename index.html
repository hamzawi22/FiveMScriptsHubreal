<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FiveM Scripts Hub - Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap');
        
        * {
            font-family: 'Cairo', sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: radial-gradient(circle at top right, #1e1b4b, #0f172a, #020617);
            color: #f8fafc;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        .gradient-text {
            background: linear-gradient(to right, #a855f7, #ec4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #4f46e5; border-radius: 10px; }
        
        .btn-discord {
            background-color: #5865F2;
            transition: all 0.3s ease;
        }
        .btn-discord:hover {
            background-color: #4752C4;
            transform: translateY(-2px);
        }

        .line-clamp-1 {
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
        }

        .line-clamp-2 {
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .loader {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid #a855f7;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        // ==========================================
        // 1. ØªÙ‡ÙŠØ¦Ø© Firebase
        // ==========================================
        const ADMIN_EMAIL = 'obywawi@gmail.com';
        const DISCORD_CLIENT_ID = '1454211006866657384';
        const REDIRECT_URI = window.location.origin + window.location.pathname;

        const firebaseConfig = {
            apiKey: "AIzaSyDbW67rYjVnUdzoF9FvfLJypGi_MF9nQjg",
            authDomain: "login-system-124a6.firebaseapp.com",
            databaseURL: "https://login-system-124a6-default-rtdb.firebaseio.com",
            projectId: "login-system-124a6",
            storageBucket: "login-system-124a6.firebasestorage.app",
            messagingSenderId: "667998653226",
            appId: "1:667998653226:web:bc4a96a2dbbd22cf386c53",
            measurementId: "G-42NY348NXE"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // ==========================================
        // 2. Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        // ==========================================
        let currentUser = null;
        let scripts = [];
        let showAuth = false;
        let showUpload = false;
        let currentPage = 'home';
        let currentScriptId = null;
        let activeCategory = 'all';
        let uploadForm = { title: '', description: '', category: 'jobs', mediaType: 'none', youtubeUrl: '' };
        let selectedFile = null;
        let selectedMedia = null;
        let downloadTimer = null;
        let downloadTimeLeft = 60;
        let isLoading = true;
        let firebaseError = false;
        let errorMessage = '';

        // ==========================================
        // 3. Ù†Ø¸Ø§Ù… Firestore
        // ==========================================
        
        async function loadScriptsFromFirestore() {
            try {
                isLoading = true;
                firebaseError = false;
                render();
                
                const snapshot = await db.collection('scripts').orderBy('date', 'desc').get();
                scripts = [];
                snapshot.forEach(doc => {
                    scripts.push({ id: doc.id, ...doc.data() });
                });
                
                console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙƒØ±Ø¨ØªØ§Øª Ù…Ù† Firestore Ø¨Ù†Ø¬Ø§Ø­:', scripts.length);
                isLoading = false;
                render();
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firestore:', error);
                firebaseError = true;
                errorMessage = 'ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª ÙˆØ§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.';
                isLoading = false;
                render();
            }
        }

        async function saveScriptToFirestore(scriptData) {
            try {
                console.log('ğŸ“¤ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Firestore...');
                console.log('ğŸ“Š Ø­Ø¬Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', JSON.stringify(scriptData).length, 'characters');
                
                // Ø¥Ø¶Ø§ÙØ© timeout
                const timeoutPromise = new Promise((_, reject) => {
                    setTimeout(() => reject(new Error('Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª')), 30000);
                });
                
                const savePromise = db.collection('scripts').add(scriptData);
                
                const docRef = await Promise.race([savePromise, timeoutPromise]);
                
                console.log('âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ ÙÙŠ Firestore - ID:', docRef.id);
                console.log('ğŸ”„ Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©...');
                
                await loadScriptsFromFirestore();
                
                console.log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­');
                return true;
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Firestore:', error);
                console.error('âŒ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø·Ø£:', error.code, error.message);
                throw new Error('ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message);
            }
        }

        async function updateScriptStats(scriptId, updates) {
            try {
                await db.collection('scripts').doc(scriptId).update(updates);
                console.log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø³ÙƒØ±Ø¨Øª');
                await loadScriptsFromFirestore();
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:', error);
                throw error;
            }
        }

        // ==========================================
        // 4. Ù†Ø¸Ø§Ù… Ø§Ù„Ù‡ÙˆÙŠØ©
        // ==========================================
        
        async function signInWithGoogle() {
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                await auth.signInWithPopup(provider);
                showAuth = false;
                render();
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø¬ÙˆØ¬Ù„:', error);
                alert("Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: " + error.message);
            }
        }

        function signInWithDiscord() {
            const url = `https://discord.com/api/oauth2/authorize?client_id=${DISCORD_CLIENT_ID}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&response_type=token&scope=identify%20email`;
            window.location.href = url;
        }

        async function handleDiscordCallback() {
            const fragment = new URLSearchParams(window.location.hash.slice(1));
            const token = fragment.get('access_token');
            if (token) {
                try {
                    const res = await fetch('https://discord.com/api/users/@me', {
                        headers: { Authorization: `Bearer ${token}` }
                    });
                    const data = await res.json();
                    currentUser = {
                        uid: 'ds_' + data.id,
                        username: data.global_name || data.username,
                        email: data.email || `${data.username}@discord.link`,
                        picture: data.avatar ? `https://cdn.discordapp.com/avatars/${data.id}/${data.avatar}.png` : 'https://cdn.discordapp.com/embed/avatars/0.png',
                        provider: 'discord'
                    };
                    
                    let userData = await getUserDataFromFirestore(currentUser.uid);
                    if (!userData) {
                        userData = { nameChanged: false, customName: null };
                        await saveUserDataToFirestore(currentUser.uid, userData);
                    }
                    currentUser.userData = userData;
                    localStorage.setItem('hub_user', JSON.stringify(currentUser));
                    window.location.hash = '';
                    render();
                } catch (e) { 
                    console.error("Ø®Ø·Ø£ ÙÙŠ Discord:", e);
                    alert("Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù€ Discord");
                }
            }
        }

        async function getUserDataFromFirestore(uid) {
            try {
                const doc = await db.collection('users').doc(uid).get();
                return doc.exists ? doc.data() : null;
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', error);
                throw error;
            }
        }

        async function saveUserDataToFirestore(uid, data) {
            try {
                await db.collection('users').doc(uid).set(data);
                console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', error);
                throw error;
            }
        }

        auth.onAuthStateChanged(async (user) => {
            if (user) {
                currentUser = {
                    uid: user.uid,
                    username: user.displayName,
                    email: user.email,
                    picture: user.photoURL,
                    provider: 'google'
                };
                try {
                    let userData = await getUserDataFromFirestore(user.uid);
                    if (!userData) {
                        userData = { nameChanged: false, customName: null };
                        await saveUserDataToFirestore(user.uid, userData);
                    }
                    currentUser.userData = userData;
                    localStorage.setItem('hub_user', JSON.stringify(currentUser));
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', error);
                }
            } else {
                const localUser = JSON.parse(localStorage.getItem('hub_user'));
                if (localUser && localUser.provider === 'discord') {
                    currentUser = localUser;
                    try {
                        let userData = await getUserDataFromFirestore(localUser.uid);
                        if (!userData) {
                            userData = { nameChanged: false, customName: null };
                            await saveUserDataToFirestore(localUser.uid, userData);
                        }
                        currentUser.userData = userData;
                    } catch (error) {
                        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', error);
                    }
                } else {
                    currentUser = null;
                }
            }
            render();
        });

        function logout() {
            auth.signOut();
            localStorage.removeItem('hub_user');
            currentUser = null;
            location.reload();
        }

        // ==========================================
        // 5. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰
        // ==========================================
        
        function handleFile(e) {
            selectedFile = e.target.files[0];
            if (selectedFile) {
                console.log('ğŸ“„ ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù:', selectedFile.name, selectedFile.size, 'bytes');
                if (selectedFile.size > 5 * 1024 * 1024) {
                    alert('âš ï¸ ØªØ­Ø°ÙŠØ±: Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù ' + (selectedFile.size / 1024 / 1024).toFixed(2) + ' MB\nØ§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù‡Ùˆ 5MB. Ù‚Ø¯ ÙŠÙØ´Ù„ Ø§Ù„Ø±ÙØ¹!');
                }
            }
            render();
        }

        function handleMedia(e) {
            selectedMedia = e.target.files[0];
            if (selectedMedia) {
                console.log('ğŸ–¼ï¸ ØªÙ… Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø©:', selectedMedia.name, selectedMedia.size, 'bytes');
                if (selectedMedia.size > 2 * 1024 * 1024) {
                    alert('âš ï¸ ØªØ­Ø°ÙŠØ±: Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© ' + (selectedMedia.size / 1024 / 1024).toFixed(2) + ' MB\nØ§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù‡Ùˆ 2MB. Ù‚Ø¯ ÙŠÙØ´Ù„ Ø§Ù„Ø±ÙØ¹!');
                }
            }
            render();
        }

        async function submitScript() {
            console.log('ğŸš€ Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ù†Ø´Ø±...');
            
            if (!selectedFile) {
                alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø§Ù„Ø³ÙƒØ±Ø¨Øª");
                return;
            }
            if (!uploadForm.title || !uploadForm.description) {
                alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
                return;
            }

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù (Ø£Ù‚Ù„ Ù…Ù† 5MB)
            if (selectedFile.size > 5 * 1024 * 1024) {
                alert("âŒ Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹! Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 5MB");
                return;
            }

            const submitBtn = document.getElementById('submitScriptBtn');
            if (submitBtn) {
                submitBtn.disabled = true;
                submitBtn.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù†Ø´Ø±...';
            }

            try {
                console.log('ğŸ“„ Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù Ø§Ù„Ø³ÙƒØ±Ø¨Øª:', selectedFile.name, selectedFile.size, 'bytes');
                const fileData = await readFileAsDataURL(selectedFile);
                console.log('âœ… ØªÙ… Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù Ø§Ù„Ø³ÙƒØ±Ø¨Øª Ø¨Ù†Ø¬Ø§Ø­');
                
                let mediaData = null;
                
                if (uploadForm.mediaType === 'image' && selectedMedia) {
                    console.log('ğŸ–¼ï¸ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ØµÙˆØ±Ø©:', selectedMedia.name);
                    if (selectedMedia.size > 2 * 1024 * 1024) {
                        throw new Error('Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹! Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 2MB');
                    }
                    const imageData = await readFileAsDataURL(selectedMedia);
                    mediaData = {
                        type: 'image',
                        data: imageData
                    };
                    console.log('âœ… ØªÙ… Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­');
                } else if (uploadForm.mediaType === 'youtube' && uploadForm.youtubeUrl) {
                    console.log('ğŸ¥ Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø· ÙŠÙˆØªÙŠÙˆØ¨');
                    mediaData = {
                        type: 'youtube',
                        url: uploadForm.youtubeUrl
                    };
                }

                console.log('ğŸ“¦ Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙƒØ±Ø¨Øª...');
                const scriptData = {
                    title: uploadForm.title,
                    description: uploadForm.description,
                    category: uploadForm.category,
                    fileName: selectedFile.name,
                    fileData: fileData,
                    media: mediaData,
                    uploader: currentUser.email,
                    uploaderUid: currentUser.uid,
                    uploaderName: currentUser.userData?.customName || currentUser.username,
                    date: new Date().toISOString(),
                    stats: { views: 0, downloads: 0, uniqueDownloads: [] }
                };

                console.log('ğŸ’¾ Ø§Ù„Ø­ÙØ¸ ÙÙŠ Firestore...');
                await saveScriptToFirestore(scriptData);
                
                console.log('ğŸ‰ ØªÙ… Ø§Ù„Ù†Ø´Ø± Ø¨Ù†Ø¬Ø§Ø­!');
                
                // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†
                showUpload = false;
                resetUpload();
                render();
                
                setTimeout(() => {
                    alert('âœ… ØªÙ… Ù†Ø´Ø± Ø§Ù„Ø³ÙƒØ±Ø¨Øª Ø¨Ù†Ø¬Ø§Ø­!');
                }, 100);
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø´Ø±:', error);
                alert("âŒ ÙØ´Ù„ Ø§Ù„Ù†Ø´Ø±: " + error.message);
                
                if (submitBtn) {
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Ù†Ø´Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰';
                }
            }
        }

        function readFileAsDataURL(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onload = (e) => {
                    console.log('âœ… FileReader: ØªÙ… Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­');
                    resolve(e.target.result);
                };
                
                reader.onerror = (e) => {
                    console.error('âŒ FileReader: ÙØ´Ù„ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù');
                    reject(new Error('ÙØ´Ù„ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù'));
                };
                
                reader.onprogress = (e) => {
                    if (e.lengthComputable) {
                        const percent = (e.loaded / e.total * 100).toFixed(0);
                        console.log(`ğŸ“Š Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù: ${percent}%`);
                    }
                };
                
                reader.readAsDataURL(file);
            });
        }

        async function viewDetails(scriptId) {
            currentScriptId = scriptId;
            const script = scripts.find(s => s.id === scriptId);
            if (script) {
                try {
                    script.stats.views++;
                    await updateScriptStats(scriptId, { 'stats.views': script.stats.views });
                    currentPage = 'scriptDetails';
                    downloadTimer = null;
                    downloadTimeLeft = 60;
                    window.scrollTo(0, 0);
                    render();
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª:', error);
                    currentPage = 'scriptDetails';
                    render();
                }
            }
        }

        function startDownloadTimer() {
            downloadTimeLeft = 60;
            downloadTimer = setInterval(() => {
                downloadTimeLeft--;
                const timerDisplay = document.getElementById('timerDisplay');
                const timerCircle = document.getElementById('timerCircle');
                if (timerDisplay) timerDisplay.textContent = downloadTimeLeft;
                if (timerCircle) {
                    const offset = 2 * Math.PI * 70 * (downloadTimeLeft / 60);
                    timerCircle.style.strokeDashoffset = offset;
                }
                if (downloadTimeLeft <= 0) {
                    clearInterval(downloadTimer);
                    downloadTimer = null;
                    render();
                }
            }, 1000);
            render();
        }

        async function actionDownload(id) {
            const s = scripts.find(x => x.id === id);
            if (!s || !currentUser) return;

            if (s.stats.uniqueDownloads.includes(currentUser.uid)) {
                return alert("âš ï¸ Ù„Ù‚Ø¯ Ù‚Ù…Øª Ø¨ØªØ­Ù…ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø³ÙƒØ±Ø¨Øª Ù…Ø³Ø¨Ù‚Ø§Ù‹");
            }

            try {
                s.stats.uniqueDownloads.push(currentUser.uid);
                s.stats.downloads++;
                
                await updateScriptStats(id, {
                    'stats.downloads': s.stats.downloads,
                    'stats.uniqueDownloads': s.stats.uniqueDownloads
                });

                const link = document.createElement('a');
                link.href = s.fileData;
                link.download = s.fileName;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                alert(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„: ${s.title}`);
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„:', error);
                alert('âŒ ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªØ­Ù…ÙŠÙ„');
            }
        }

        async function updateUserName(newName) {
            if (!currentUser || !newName) return;
            
            try {
                const userData = await getUserDataFromFirestore(currentUser.uid);
                if (userData.nameChanged) {
                    return alert("âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± Ø§Ù„Ø§Ø³Ù… Ù…Ø±Ø© Ø£Ø®Ø±Ù‰");
                }

                userData.customName = newName;
                userData.nameChanged = true;
                await saveUserDataToFirestore(currentUser.uid, userData);
                currentUser.userData = userData;
                localStorage.setItem('hub_user', JSON.stringify(currentUser));
                
                alert("âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³Ù… Ø¨Ù†Ø¬Ø§Ø­!");
                render();
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³Ù…:', error);
                alert('âŒ ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³Ù…: ' + error.message);
            }
        }

        function resetUpload() {
            uploadForm = { title: '', description: '', category: 'jobs', mediaType: 'none', youtubeUrl: '' };
            selectedFile = null;
            selectedMedia = null;
        }

        function goHome() {
            currentPage = 'home';
            currentScriptId = null;
            if (downloadTimer) {
                clearInterval(downloadTimer);
                downloadTimer = null;
            }
            render();
        }

        function retryConnection() {
            location.reload();
        }

        // ==========================================
        // 6. ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        // ==========================================
        
        function render() {
            const app = document.getElementById('app');
            const isAdmin = currentUser?.email === ADMIN_EMAIL;
            const filtered = activeCategory === 'all' ? scripts : scripts.filter(s => s.category === activeCategory);
            const displayName = currentUser?.userData?.customName || currentUser?.username;
            const currentScript = currentScriptId ? scripts.find(s => s.id === currentScriptId) : null;

            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø®Ø·Ø£ ÙÙŠ Firebase
            if (firebaseError) {
                app.innerHTML = `
                    <div class="flex items-center justify-center min-h-screen p-6">
                        <div class="glass-card rounded-[40px] p-12 max-w-2xl text-center">
                            <div class="text-8xl mb-8">âŒ</div>
                            <h1 class="text-4xl font-black mb-6 text-red-400">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h1>
                            <p class="text-gray-300 text-lg mb-8 leading-relaxed">${errorMessage}</p>
                            <div class="space-y-4">
                                <button onclick="retryConnection()" class="w-full bg-purple-600 hover:bg-purple-700 px-8 py-4 rounded-2xl font-black text-xl transition-all shadow-lg">
                                    ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
                                </button>
                                <p class="text-sm text-gray-500">ØªØ£ÙƒØ¯ Ù…Ù†:</p>
                                <ul class="text-sm text-gray-400 space-y-2">
                                    <li>âœ“ Ø§ØªØµØ§Ù„Ùƒ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª</li>
                                    <li>âœ“ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase ØµØ­ÙŠØ­Ø©</li>
                                    <li>âœ“ Ù‚ÙˆØ§Ø¹Ø¯ Firestore Ù…ÙØ¹Ù„Ø©</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
                return;
            }

            // Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
            if (isLoading) {
                app.innerHTML = `
                    <div class="flex items-center justify-center min-h-screen">
                        <div class="text-center">
                            <div class="loader mx-auto mb-4"></div>
                            <p class="text-gray-400 text-xl">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ù† Firebase...</p>
                        </div>
                    </div>
                `;
                return;
            }

            app.innerHTML = `
                <nav class="glass-card sticky top-0 z-[100] px-6 py-4 border-b border-white/5">
                    <div class="container mx-auto flex justify-between items-center">
                        <div class="flex items-center gap-4 cursor-pointer" onclick="goHome()">
                            <div class="bg-gradient-to-br from-purple-600 to-pink-600 p-2 rounded-xl shadow-lg">
                                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg>
                            </div>
                            <span class="text-2xl font-black gradient-text tracking-tighter">FIVEM HUB</span>
                        </div>

                        <div class="flex items-center gap-6">
                            ${currentUser ? `
                                <button onclick="goHome()" class="hidden md:block px-4 py-2 rounded-xl ${currentPage === 'home' ? 'bg-purple-600 font-bold' : 'text-gray-400 hover:text-white'} transition-all">
                                    Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                                </button>
                                <button onclick="currentPage='settings';currentScriptId=null;render()" class="hidden md:block px-4 py-2 rounded-xl ${currentPage === 'settings' ? 'bg-purple-600 font-bold' : 'text-gray-400 hover:text-white'} transition-all">
                                    Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                                </button>
                                <div class="flex items-center gap-3">
                                    <img src="${currentUser.picture}" class="w-10 h-10 rounded-full border-2 border-purple-500/50 p-0.5">
                                    ${isAdmin ? `<button onclick="showUpload=true;render()" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg text-sm font-bold transition-all shadow-lg">â• Ø±ÙØ¹</button>` : ''}
                                </div>
                            ` : `
                                <button onclick="showAuth=true;render()" class="bg-white text-slate-900 px-6 py-2 rounded-xl font-black hover:bg-purple-50 transition-all">Ø¯Ø®ÙˆÙ„</button>
                            `}
                        </div>
                    </div>
                </nav>

                ${!currentUser ? `
                    <section class="container mx-auto px-6 py-24 text-center">
                        <h1 class="text-5xl md:text-8xl font-black mb-8 leading-tight tracking-tight">Ø³ÙŠØ±ÙØ±Ùƒ ÙŠØ³ØªØ­Ù‚ <br><span class="gradient-text italic">Ø§Ù„Ø£ÙØ¶Ù„ Ø¯Ø§Ø¦Ù…Ø§Ù‹</span></h1>
                        <p class="text-gray-400 text-xl max-w-2xl mx-auto mb-12">ØªØ­Ù…ÙŠÙ„ Ø³ÙƒØ±Ø¨ØªØ§Øª FiveM Ø§Ù„Ø­ØµØ±ÙŠØ© Ù…Ø¬Ø§Ù†Ø§Ù‹. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª ÙŠØªÙ… ÙØ­ØµÙ‡Ø§ ÙˆØªØ¯Ù‚ÙŠÙ‚Ù‡Ø§ Ù„Ø¶Ù…Ø§Ù† Ø£Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ø£Ù…Ø§Ù†.</p>
                        <button onclick="showAuth=true;render()" class="bg-purple-600 px-12 py-5 rounded-2xl font-black text-2xl hover:scale-105 transition-all shadow-2xl shadow-purple-500/40">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù† - Ù…Ø¬Ø§Ù†Ø§Ù‹</button>
                        
                        <div class="mt-20 grid grid-cols-1 md:grid-cols-3 gap-8 text-center max-w-4xl mx-auto">
                            <div class="glass-card rounded-3xl p-8">
                                <div class="text-5xl mb-4">ğŸ®</div>
                                <h3 class="text-xl font-bold mb-2">Ø³ÙƒØ±Ø¨ØªØ§Øª Ø­ØµØ±ÙŠØ©</h3>
                                <p class="text-gray-400 text-sm">Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¶Ø®Ù…Ø© Ù…Ù† Ø§Ù„Ø³ÙƒØ±Ø¨ØªØ§Øª Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø¬ÙˆØ¯Ø©</p>
                            </div>
                            <div class="glass-card rounded-3xl p-8">
                                <div class="text-5xl mb-4">ğŸ›¡ï¸</div>
                                <h3 class="text-xl font-bold mb-2">Ø¢Ù…Ù† 100%</h3>
                                <p class="text-gray-400 text-sm">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ù…ÙØ­ÙˆØµØ© ÙˆÙ…Ø¯Ù‚Ù‚Ø©</p>
                            </div>
                            <div class="glass-card rounded-3xl p-8">
                                <div class="text-5xl mb-4">âš¡</div>
                                <h3 class="text-xl font-bold mb-2">ØªØ­Ø¯ÙŠØ«Ø§Øª Ø¯ÙˆØ±ÙŠØ©</h3>
                                <p class="text-gray-400 text-sm">Ù…Ø­ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯ ÙŠØ¶Ø§Ù Ø¨Ø§Ø³ØªÙ…Ø±Ø§Ø±</p>
                            </div>
                        </div>
                    </section>
                ` : currentPage === 'home' ? `
                    <div class="container mx-auto px-6 mt-10">
                        <div class="flex gap-4 overflow-x-auto pb-4">
                            ${['all', 'jobs', 'cars', 'maps', 'scripts', 'other'].map(cat => `
                                <button onclick="activeCategory='${cat}';render()" class="px-8 py-3 rounded-2xl border transition-all ${activeCategory === cat ? 'bg-purple-600 border-purple-400 font-bold shadow-lg' : 'border-white/10 glass-card text-gray-400 hover:text-white hover:bg-white/5'}">
                                    ${cat === 'all' ? 'Ø§Ù„ÙƒÙ„' : cat.charAt(0).toUpperCase() + cat.slice(1)}
                                </button>
                            `).join('')}
                        </div>

                        ${filtered.length === 0 ? `
                            <div class="text-center py-20">
                                <div class="text-6xl mb-4">ğŸ“¦</div>
                                <p class="text-gray-400 text-xl">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³ÙƒØ±Ø¨ØªØ§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ØªØµÙ†ÙŠÙ</p>
                            </div>
                        ` : `
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mt-12 mb-20">
                                ${filtered.map(s => {
                                    let mediaHtml = '';
                                    if (s.media) {
                                        if (s.media.type === 'image') {
                                            mediaHtml = `<img src="${s.media.data}" class="w-full h-36 object-cover rounded-t-[24px]">`;
                                        } else if (s.media.type === 'youtube') {
                                            const videoId = s.media.url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&]+)/)?.[1];
                                            if (videoId) {
                                                mediaHtml = `<img src="https://img.youtube.com/vi/${videoId}/maxresdefault.jpg" class="w-full h-36 object-cover rounded-t-[24px]">`;
                                            }
                                        }
                                    }
                                    
                                    return `
                                    <div class="glass-card rounded-[24px] overflow-hidden border border-white/5 hover:border-purple-500/40 transition-all duration-500 relative group cursor-pointer" onclick="viewDetails('${s.id}')">
                                        ${mediaHtml}
                                        <div class="p-5">
                                            <div class="flex justify-between items-center mb-3">
                                                <span class="bg-purple-600/20 text-purple-400 text-[9px] font-black px-2 py-1 rounded-full uppercase tracking-tighter border border-purple-500/20">${s.category}</span>
                                                <span class="text-[9px] text-gray-500">${new Date(s.date).toLocaleDateString('ar-EG')}</span>
                                            </div>
                                            <h3 class="text-lg font-bold mb-2 line-clamp-1">${s.title}</h3>
                                            <p class="text-gray-400 text-xs mb-4 leading-relaxed h-8 overflow-hidden line-clamp-2">${s.description}</p>
                                            
                                            <div class="flex items-center gap-4 mb-4 text-[10px] text-gray-500 border-y border-white/5 py-2">
                                                <div class="flex items-center gap-1">ğŸ‘ï¸ <span class="font-bold text-white">${s.stats.views}</span></div>
                                                <div class="flex items-center gap-1">â¬‡ï¸ <span class="font-bold text-white">${s.stats.downloads}</span></div>
                                            </div>

                                            <button class="w-full bg-white text-black py-2.5 rounded-xl text-sm font-black hover:bg-purple-600 hover:text-white transition-all transform group-hover:scale-[1.02]">Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„</button>
                                            
                                            ${s.uploaderUid === currentUser?.uid ? `
                                                <div class="mt-3 text-center">
                                                    <span class="text-green-400 font-black text-sm">$${(s.stats.downloads * 0.05).toFixed(2)}</span>
                                                </div>
                                            ` : ''}
                                        </div>
                                    </div>
                                `}).join('')}
                            </div>
                        `}
                    </div>
                ` : currentPage === 'scriptDetails' && currentScript ? `
                    <div class="container mx-auto px-6 mt-10 mb-20">
                        <button onclick="goHome()" class="mb-8 flex items-center gap-2 text-gray-400 hover:text-white transition-all">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                            Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                        </button>

                        <div class="max-w-5xl mx-auto">
                            ${currentScript.media ? (() => {
                                if (currentScript.media.type === 'image') {
                                    return `<img src="${currentScript.media.data}" class="w-full h-[500px] object-cover rounded-[40px] mb-10 shadow-2xl">`;
                                } else if (currentScript.media.type === 'youtube') {
                                    const videoId = currentScript.media.url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&]+)/)?.[1];
                                    if (videoId) {
                                        return `<iframe src="https://www.youtube.com/embed/${videoId}" class="w-full h-[500px] rounded-[40px] mb-10 shadow-2xl" frameborder="0" allowfullscreen></iframe>`;
                                    }
                                }
                                return '';
                            })() : ''}

                            <div class="glass-card rounded-[40px] p-10 mb-8">
                                <div class="flex justify-between items-start mb-8">
                                    <div>
                                        <span class="bg-purple-600/20 text-purple-400 text-xs font-black px-4 py-2 rounded-full uppercase tracking-tighter border border-purple-500/20">${currentScript.category}</span>
                                    </div>
                                    <span class="text-sm text-gray-500">${new Date(currentScript.date).toLocaleDateString('ar-EG')}</span>
                                </div>

                                <h1 class="text-5xl font-black mb-6">${currentScript.title}</h1>
                                <p class="text-gray-300 text-xl mb-10 leading-relaxed">${currentScript.description}</p>

                                <div class="grid grid-cols-3 gap-6 mb-10">
                                    <div class="glass-card rounded-2xl p-6 text-center">
                                        <div class="text-4xl mb-3">ğŸ‘ï¸</div>
                                        <div class="text-3xl font-black text-white mb-2">${currentScript.stats.views}</div>
                                        <div class="text-sm text-gray-500">Ù…Ø´Ø§Ù‡Ø¯Ø©</div>
                                    </div>
                                    <div class="glass-card rounded-2xl p-6 text-center">
                                        <div class="text-4xl mb-3">â¬‡ï¸</div>
                                        <div class="text-3xl font-black text-white mb-2">${currentScript.stats.downloads}</div>
                                        <div class="text-sm text-gray-500">ØªØ­Ù…ÙŠÙ„</div>
                                    </div>
                                    <div class="glass-card rounded-2xl p-6 text-center">
                                        <div class="text-4xl mb-3">ğŸ›¡ï¸</div>
                                        <div class="text-3xl font-black text-green-400 mb-2">Ø¢Ù…Ù†</div>
                                        <div class="text-sm text-gray-500">Ù…Ø­Ù…ÙŠ</div>
                                    </div>
                                </div>

                                <div class="glass-card rounded-3xl p-8 mb-8 border border-white/5">
                                    <h3 class="text-xl font-bold mb-4">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø§Ø´Ø±</h3>
                                    <div class="flex items-center gap-4 mb-6">
                                        <div class="w-12 h-12 rounded-full bg-gradient-to-br from-purple-600 to-pink-600 flex items-center justify-center text-2xl font-black">
                                            ${currentScript.uploaderName.charAt(0)}
                                        </div>
                                        <div>
                                            <div class="text-lg font-bold">${currentScript.uploaderName}</div>
                                            <div class="text-sm text-gray-500">${currentScript.uploader}</div>
                                        </div>
                                    </div>
                                    <div class="text-sm text-gray-600 border-t border-white/5 pt-4">
                                        <div class="flex justify-between mb-2">
                                            <span>Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù:</span>
                                            <span class="text-white font-bold">${currentScript.fileName}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø´Ø±:</span>
                                            <span class="text-white font-bold">${new Date(currentScript.date).toLocaleDateString('ar-EG', { year: 'numeric', month: 'long', day: 'numeric' })}</span>
                                        </div>
                                    </div>
                                </div>

                                ${downloadTimer === null && !currentScript.stats.uniqueDownloads.includes(currentUser?.uid) ? `
                                    <button onclick="startDownloadTimer()" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-8 rounded-3xl font-black text-2xl transition-all shadow-2xl shadow-purple-500/30">
                                        ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„
                                    </button>
                                ` : currentScript.stats.uniqueDownloads.includes(currentUser?.uid) ? `
                                    <div class="bg-yellow-500/10 border border-yellow-500/30 rounded-3xl p-8 text-center">
                                        <div class="text-5xl mb-4">âš ï¸</div>
                                        <div class="text-yellow-400 font-bold text-2xl">Ù„Ù‚Ø¯ Ù‚Ù…Øª Ø¨ØªØ­Ù…ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø³ÙƒØ±Ø¨Øª Ù…Ù† Ù‚Ø¨Ù„</div>
                                        <p class="text-gray-400 text-sm mt-3">ÙƒÙ„ Ù…Ø³ØªØ®Ø¯Ù… ÙŠÙ…ÙƒÙ†Ù‡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙƒØ±Ø¨Øª Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·</p>
                                    </div>
                                ` : downloadTimeLeft > 0 ? `
                                    <div class="bg-gradient-to-r from-purple-600/20 to-pink-600/20 rounded-3xl p-12 text-center border border-purple-500/30">
                                        <div class="relative w-40 h-40 mx-auto mb-8">
                                            <svg class="transform -rotate-90 w-40 h-40">
                                                <circle cx="80" cy="80" r="70" stroke="rgba(255,255,255,0.1)" stroke-width="10" fill="none" />
                                                <circle id="timerCircle" cx="80" cy="80" r="70" stroke="#a855f7" stroke-width="10" fill="none"
                                                    stroke-dasharray="${2 * Math.PI * 70}"
                                                    stroke-dashoffset="${2 * Math.PI * 70 * (downloadTimeLeft / 60)}"
                                                    style="transition: stroke-dashoffset 1s linear" />
                                            </svg>
                                            <div class="absolute inset-0 flex items-center justify-center">
                                                <span id="timerDisplay" class="text-5xl font-black">${downloadTimeLeft}</span>
                                            </div>
                                        </div>
                                        <div class="text-2xl font-bold text-gray-300 mb-3">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£Ù…Ø§Ù†...</div>
                                        <div class="text-base text-gray-500">ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø­ØªÙ‰ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙØ­Øµ Ø§Ù„Ø£Ù…Ù†ÙŠ Ù„Ù„Ù…Ù„Ù</div>
                                    </div>
                                ` : `
                                    <button onclick="actionDownload('${currentScript.id}')" class="w-full bg-green-600 hover:bg-green-700 text-white py-8 rounded-3xl font-black text-2xl transition-all shadow-2xl shadow-green-500/30 animate-pulse">
                                        âœ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¢Ù†
                                    </button>
                                `}
                            </div>
                        </div>
                    </div>
                ` : `
                    <div class="container mx-auto px-6 mt-10 mb-20">
                        <div class="max-w-3xl mx-auto">
                            <h2 class="text-4xl font-black mb-10 italic">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª âš™ï¸</h2>
                            
                            <div class="glass-card rounded-[40px] p-10 mb-8">
                                <h3 class="text-2xl font-bold mb-6">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨</h3>
                                <div class="flex items-center gap-6 mb-8">
                                    <img src="${currentUser.picture}" class="w-24 h-24 rounded-3xl border-4 border-purple-500/50">
                                    <div>
                                        <h4 class="text-xl font-bold mb-2">${displayName}</h4>
                                        <p class="text-gray-400 text-sm">${currentUser.email}</p>
                                        <span class="text-xs text-purple-400 mt-2 block">Ù…Ù‚Ø¯Ù… Ù…Ù† ${currentUser.provider === 'google' ? 'Google' : 'Discord'}</span>
                                    </div>
                                </div>

                                <div class="border-t border-white/10 pt-8">
                                    <h4 class="text-sm font-black text-gray-500 uppercase mb-4">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø³Ù…</h4>
                                    ${!currentUser.userData.nameChanged ? `
                                        <div class="flex gap-4">
                                            <input type="text" id="newName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯" class="flex-1 bg-white/5 border border-white/10 rounded-2xl px-6 py-3 outline-none focus:border-purple-500 transition-all">
                                            <button onclick="updateUserName(document.getElementById('newName').value)" class="bg-purple-600 hover:bg-purple-700 px-8 py-3 rounded-2xl font-black transition-all">Ø­ÙØ¸</button>
                                        </div>
                                        <p class="text-yellow-400 text-xs mt-3 font-bold">âš ï¸ ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± Ø§Ù„Ø§Ø³Ù… Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·!</p>
                                    ` : `
                                        <p class="text-gray-400 text-sm">âœ… Ù„Ù‚Ø¯ Ù‚Ù…Øª Ø¨ØªØºÙŠÙŠØ± Ø§Ø³Ù…Ùƒ Ù…Ù† Ù‚Ø¨Ù„. Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„Ù‡ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.</p>
                                    `}
                                </div>
                            </div>

                            <div class="glass-card rounded-[40px] p-10 mb-8">
                                <h3 class="text-2xl font-bold mb-6">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø­ØªÙˆÙ‰</h3>
                                <div class="grid grid-cols-3 gap-6 text-center">
                                    <div>
                                        <div class="text-4xl font-black text-purple-400 mb-2">${scripts.filter(s => s.uploaderUid === currentUser.uid).length}</div>
                                        <div class="text-xs text-gray-500">Ø³ÙƒØ±Ø¨ØªØ§Øª Ù…Ù†Ø´ÙˆØ±Ø©</div>
                                    </div>
                                    <div>
                                        <div class="text-4xl font-black text-green-400 mb-2">${scripts.filter(s => s.uploaderUid === currentUser.uid).reduce((sum, s) => sum + s.stats.downloads, 0)}</div>
                                        <div class="text-xs text-gray-500">ØªØ­Ù…ÙŠÙ„Ø§Øª</div>
                                    </div>
                                    <div>
                                        <div class="text-4xl font-black text-yellow-400 mb-2">${scripts.filter(s => s.uploaderUid === currentUser.uid).reduce((sum, s) => sum + s.stats.views, 0)}</div>
                                        <div class="text-xs text-gray-500">Ù…Ø´Ø§Ù‡Ø¯Ø§Øª</div>
                                    </div>
                                </div>
                            </div>

                            <div class="glass-card rounded-[40px] p-10">
                                <h3 class="text-2xl font-bold mb-6 text-red-400">Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø®Ø·Ø±</h3>
                                <button onclick="if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) logout()" class="w-full bg-red-600/20 hover:bg-red-600/30 border border-red-500/50 text-red-400 py-4 rounded-2xl font-black transition-all">
                                    ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                                </button>
                            </div>
                        </div>
                    </div>
                `}

                ${showAuth ? `
                    <div class="fixed inset-0 z-[200] flex items-center justify-center p-4">
                        <div class="absolute inset-0 bg-slate-950/90 backdrop-blur-md" onclick="showAuth=false;render()"></div>
                        <div class="glass-card w-full max-w-md rounded-[45px] p-12 relative border border-white/10">
                            <div class="text-center mb-10">
                                <div class="w-20 h-20 bg-gradient-to-tr from-purple-600 to-pink-500 rounded-3xl mx-auto mb-6 flex items-center justify-center rotate-12 shadow-2xl">
                                    <svg class="w-10 h-10 text-white -rotate-12" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>
                                </div>
                                <h2 class="text-3xl font-black mb-3 italic">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ!</h2>
                                <p class="text-gray-400 text-sm">Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ù„ØªØªÙ…ÙƒÙ† Ù…Ù† ØªØ­Ù…ÙŠÙ„ ÙˆØ±ÙØ¹ Ø§Ù„Ø³ÙƒØ±Ø¨ØªØ§Øª</p>
                            </div>
                            
                            <div class="space-y-4">
                                <button onclick="signInWithGoogle()" class="w-full bg-white text-black py-4 rounded-2xl font-black flex items-center justify-center gap-3 hover:bg-gray-200 transition-all">
                                    <img src="https://www.google.com/favicon.ico" class="w-5">
                                    Ø¨ÙˆØ§Ø³Ø·Ø© Ø¬ÙˆØ¬Ù„
                                </button>

                                <button onclick="signInWithDiscord()" class="btn-discord w-full text-white py-4 rounded-2xl font-black flex items-center justify-center gap-3 shadow-xl shadow-indigo-500/20">
                                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.06.06 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.158-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.966 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.158-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.946 2.418-2.157 2.418z"/>
                                    </svg>
                                    Ø¨ÙˆØ§Ø³Ø·Ø© Ø¯ÙŠØ³ÙƒÙˆØ±Ø¯
                                </button>
                            </div>
                            <button onclick="showAuth=false;render()" class="mt-8 w-full text-gray-500 text-xs font-bold hover:text-white transition-colors tracking-widest uppercase">Ø¥ØºÙ„Ø§Ù‚</button>
                        </div>
                    </div>
                ` : ''}

                ${showUpload ? `
                    <div class="fixed inset-0 z-[200] flex items-center justify-center p-4">
                        <div class="absolute inset-0 bg-slate-950/90 backdrop-blur-md" onclick="showUpload=false;resetUpload();render()"></div>
                        <div class="glass-card w-full max-w-2xl rounded-[40px] p-10 relative max-h-[90vh] overflow-y-auto">
                            <h2 class="text-3xl font-black mb-8 italic">Ù†Ø´Ø± Ø³ÙƒØ±Ø¨Øª Ø¬Ø¯ÙŠØ¯ ğŸš€</h2>
                            <div class="space-y-6 text-right">
                                <div>
                                    <label class="block text-[10px] font-black text-gray-500 uppercase mb-2 mr-2">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
                                    <input type="text" value="${uploadForm.title}" oninput="uploadForm.title=this.value" class="w-full bg-white/5 border border-white/10 rounded-2xl px-6 py-4 focus:border-purple-500 outline-none transition-all">
                                </div>
                                <div>
                                    <label class="block text-[10px] font-black text-gray-500 uppercase mb-2 mr-2">ÙˆØµÙ Ø§Ù„Ø³ÙƒØ±Ø¨Øª</label>
                                    <textarea oninput="uploadForm.description=this.value" class="w-full bg-white/5 border border-white/10 rounded-2xl px-6 py-4 h-32 focus:border-purple-500 outline-none transition-all">${uploadForm.description}</textarea>
                                </div>

                                <div>
                                    <label class="block text-[10px] font-black text-gray-500 uppercase mb-2 mr-2">Ø§Ù„ØµÙˆØ±Ø© Ø£Ùˆ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</label>
                                    <div class="space-y-4">
                                        <div class="flex gap-4">
                                            <button onclick="uploadForm.mediaType='none';render()" class="flex-1 py-3 rounded-xl border ${uploadForm.mediaType === 'none' ? 'bg-purple-600 border-purple-400' : 'border-white/10 text-gray-400'}">Ø¨Ø¯ÙˆÙ†</button>
                                            <button onclick="uploadForm.mediaType='image';render()" class="flex-1 py-3 rounded-xl border ${uploadForm.mediaType === 'image' ? 'bg-purple-600 border-purple-400' : 'border-white/10 text-gray-400'}">ØµÙˆØ±Ø©</button>
                                            <button onclick="uploadForm.mediaType='youtube';render()" class="flex-1 py-3 rounded-xl border ${uploadForm.mediaType === 'youtube' ? 'bg-purple-600 border-purple-400' : 'border-white/10 text-gray-400'}">ÙŠÙˆØªÙŠÙˆØ¨</button>
                                        </div>

                                        ${uploadForm.mediaType === 'image' ? `
                                            <div>
                                                <label class="block text-xs text-gray-500 mb-2">Ø§Ø®ØªØ± ØµÙˆØ±Ø© (Ø£Ù‚ØµÙ‰ Ø­Ø¯ 2MB)</label>
                                                <input type="file" accept="image/*" onchange="handleMedia(event)" class="w-full text-xs text-gray-400 py-3">
                                            </div>
                                            ${selectedMedia ? `
                                                <div class="mt-2">
                                                    <p class="text-green-400 text-sm">âœ… ØªÙ… Ø§Ø®ØªÙŠØ§Ø±: ${selectedMedia.name}</p>
                                                    <p class="text-gray-500 text-xs">Ø§Ù„Ø­Ø¬Ù…: ${(selectedMedia.size / 1024).toFixed(2)} KB</p>
                                                </div>
                                            ` : ''}
                                        ` : uploadForm.mediaType === 'youtube' ? `
                                            <input type="text" value="${uploadForm.youtubeUrl}" placeholder="https://www.youtube.com/watch?v=..." oninput="uploadForm.youtubeUrl=this.value" class="w-full bg-white/5 border border-white/10 rounded-2xl px-6 py-4 focus:border-purple-500 outline-none transition-all text-sm">
                                        ` : ''}
                                    </div>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-[10px] font-black text-gray-500 uppercase mb-2 mr-2">Ø§Ù„ØªØµÙ†ÙŠÙ</label>
                                        <select onchange="uploadForm.category=this.value" class="w-full bg-slate-800 border border-white/10 rounded-2xl px-6 py-4 outline-none">
                                            <option value="jobs" ${uploadForm.category === 'jobs' ? 'selected' : ''}>Jobs</option>
                                            <option value="cars" ${uploadForm.category === 'cars' ? 'selected' : ''}>Cars</option>
                                            <option value="maps" ${uploadForm.category === 'maps' ? 'selected' : ''}>Maps</option>
                                            <option value="scripts" ${uploadForm.category === 'scripts' ? 'selected' : ''}>Scripts</option>
                                            <option value="other" ${uploadForm.category === 'other' ? 'selected' : ''}>Other</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-[10px] font-black text-gray-500 uppercase mb-2 mr-2">Ù…Ù„Ù Ø§Ù„Ø³ÙƒØ±Ø¨Øª (Ø£Ù‚ØµÙ‰ Ø­Ø¯ 5MB)</label>
                                        <input type="file" onchange="handleFile(event)" class="w-full text-xs text-gray-400 py-3">
                                        ${selectedFile ? `
                                            <p class="text-green-400 text-xs mt-2">âœ… ${selectedFile.name}</p>
                                            <p class="text-gray-500 text-xs">Ø§Ù„Ø­Ø¬Ù…: ${(selectedFile.size / 1024).toFixed(2)} KB</p>
                                        ` : ''}
                                    </div>
                                </div>

                                <div class="flex gap-4 pt-6">
                                    <button id="submitScriptBtn" onclick="submitScript()" class="flex-1 bg-gradient-to-r from-purple-600 to-pink-600 py-4 rounded-2xl font-black shadow-xl hover:scale-[1.02] transition-transform">Ù†Ø´Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰</button>
                                    <button onclick="showUpload=false;resetUpload();render()" class="px-8 py-4 bg-white/5 rounded-2xl font-bold hover:bg-white/10 transition-all">Ø¥Ù„ØºØ§Ø¡</button>
                                </div>
                            </div>
                        </div>
                    </div>
                ` : ''}

                <footer class="py-12 text-center text-gray-600 border-t border-white/5 mt-auto">
                    <p class="text-[10px] font-black uppercase tracking-[0.5em]">FiveM Hub Platform 2025</p>
                </footer>
            `;
        }

        // ==========================================
        // 7. Ø§Ù„ØªØ´ØºÙŠÙ„
        // ==========================================
        window.onload = async () => {
            handleDiscordCallback();
            await loadScriptsFromFirestore();
        };
    </script>
</body>
</html>
