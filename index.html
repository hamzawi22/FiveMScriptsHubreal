<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FiveM Scripts Hub - Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap');
        * { font-family: 'Cairo', sans-serif; margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #020617; color: #f8fafc; min-height: 100vh; overflow-y: auto; }
        .bg-glow { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at 50% -20%, #312e81, #020617 70%); z-index: -1; }
        .glass { background: rgba(255, 255, 255, 0.02); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.08); }
        .btn-primary { background: linear-gradient(135deg, #9333ea, #c026d3); transition: all 0.3s ease; }
        .fade-in { animation: fadeIn 0.4s ease forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #4f46e5; border-radius: 10px; }
    </style>
</head>
<body>
    <div class="bg-glow"></div>
    <div id="app"></div>

    <script>
        // 1. Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        const ADMIN_EMAIL = 'obywawi@gmail.com';
        const DISCORD_CLIENT_ID = '1454211006866657384';
        const firebaseConfig = {
            apiKey: "AIzaSyDbW67rYjVnUdzoF9FvfLJypGi_MF9nQjg",
            authDomain: "login-system-124a6.firebaseapp.com",
            projectId: "login-system-124a6",
            storageBucket: "login-system-124a6.firebasestorage.app",
            messagingSenderId: "667998653226",
            appId: "1:667998653226:web:bc4a96a2dbbd22cf386c53"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();

        // 2. Ø§Ù„Ø­Ø§Ù„Ø©
        let currentUser = null;
        let scripts = JSON.parse(localStorage.getItem('hub_scripts')) || [];
        let showAuth = false;
        let showUpload = false;
        let showDetails = null;
        let currentPage = 'home';
        let activeCategory = 'all';
        let uploadForm = { title: '', description: '', category: 'scripts', mediaType: 'none', youtubeUrl: '', file: null, image: null };

        // 3. ÙˆØ¸ÙŠÙØ© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        auth.onAuthStateChanged(user => {
            if (user) {
                const localData = JSON.parse(localStorage.getItem('u_data_' + user.uid)) || { 
                    name: user.displayName || "User", 
                    img: user.photoURL || "https://ui-avatars.com/api/?name=User", 
                    nameChanged: false 
                };
                currentUser = { uid: user.uid, email: user.email, ...localData };
            } else { currentUser = null; }
            render();
        });

        function loginGoogle() { auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()).then(() => showAuth = false); }

        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø¯ÙŠØ³ÙƒÙˆØ±Ø¯ (ØªØ³ØªØ®Ø¯Ù… OAuth2 Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø¨Ø§Ø´Ø±)
        function loginDiscord() {
            const redirectUri = encodeURIComponent(window.location.origin + window.location.pathname);
            const scope = encodeURIComponent('identify email');
            const discordUrl = `https://discord.com/api/oauth2/authorize?client_id=${DISCORD_CLIENT_ID}&redirect_uri=${redirectUri}&response_type=token&scope=${scope}`;
            window.location.href = discordUrl;
        }

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¹ÙˆØ¯Ø© Ù…Ù† Ø§Ù„Ø¯ÙŠØ³ÙƒÙˆØ±Ø¯ (Token)
        window.onload = () => {
            const fragment = new URLSearchParams(window.location.hash.slice(1));
            const accessToken = fragment.get('access_token');
            if (accessToken) {
                fetch('https://discord.com/api/users/@me', {
                    headers: { authorization: `Bearer ${accessToken}` }
                })
                .then(res => res.json())
                .then(data => {
                    const discordUser = {
                        uid: 'ds_' + data.id,
                        email: data.email,
                        displayName: data.global_name || data.username,
                        photoURL: `https://cdn.discordapp.com/avatars/${data.id}/${data.avatar}.png`
                    };
                    // Ù…Ø­Ø§ÙƒØ§Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙÙŠ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ø¯ÙŠØ³ÙƒÙˆØ±Ø¯
                    const localData = { name: discordUser.displayName, img: discordUser.photoURL, nameChanged: false };
                    localStorage.setItem('u_data_' + discordUser.uid, JSON.stringify(localData));
                    currentUser = { ...discordUser, ...localData };
                    window.location.hash = ""; // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø±Ø§Ø¨Ø·
                    render();
                });
            }
        };

        function logout() { 
            auth.signOut().then(() => {
                currentUser = null;
                currentPage = 'home';
                render();
            });
        }

        function updateProfile(newName, newImgBase64) {
            const data = JSON.parse(localStorage.getItem('u_data_' + currentUser.uid)) || {};
            if (newName && newName !== currentUser.name && !currentUser.nameChanged) {
                data.name = newName;
                data.nameChanged = true;
            }
            if (newImgBase64) data.img = newImgBase64;
            localStorage.setItem('u_data_' + currentUser.uid, JSON.stringify(data));
            currentUser = { ...currentUser, ...data };
            alert("ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­");
            render();
        }

        function handleFile(e, type) {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = (ev) => {
                if(type === 'profile') updateProfile(null, ev.target.result);
                if(type === 'upload_img') { uploadForm.image = ev.target.result; render(); }
            };
            if(file) reader.readAsDataURL(file);
        }

        function handleView(id) {
            const s = scripts.find(x => x.id === id);
            if (!s.stats.viewedBy) s.stats.viewedBy = [];
            if (currentUser && !s.stats.viewedBy.includes(currentUser.uid)) {
                s.stats.viewedBy.push(currentUser.uid);
                s.stats.views = (s.stats.views || 0) + 1;
                localStorage.setItem('hub_scripts', JSON.stringify(scripts));
            }
            showDetails = s;
            render();
        }

        function submitScript() {
            if (!uploadForm.title || !uploadForm.file) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
            const reader = new FileReader();
            reader.onload = (e) => {
                const newScript = {
                    id: 'sc_' + Date.now(),
                    title: uploadForm.title,
                    description: uploadForm.description,
                    category: uploadForm.category,
                    fileData: e.target.result,
                    fileName: uploadForm.file.name,
                    media: uploadForm.mediaType === 'image' ? { type: 'image', data: uploadForm.image } : 
                           uploadForm.mediaType === 'youtube' ? { type: 'youtube', url: uploadForm.youtubeUrl } : null,
                    stats: { views: 0, downloads: 0, viewedBy: [], downloadedBy: [] },
                    date: new Date().toISOString()
                };
                scripts.unshift(newScript);
                localStorage.setItem('hub_scripts', JSON.stringify(scripts));
                showUpload = false;
                render();
            };
            reader.readAsDataURL(uploadForm.file);
        }

        // 4. Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        function render() {
            const app = document.getElementById('app');
            const filtered = activeCategory === 'all' ? scripts : scripts.filter(s => s.category === activeCategory);

            app.innerHTML = `
                <nav class="glass sticky top-0 z-50 px-6 py-4 border-b border-white/5">
                    <div class="container mx-auto flex justify-between items-center">
                        <h1 class="text-2xl font-black bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent cursor-pointer" onclick="currentPage='home';render()">FIVEM HUB</h1>
                        <div class="flex items-center gap-4">
                            ${currentUser ? `
                                <button onclick="currentPage='home';render()" class="text-sm ${currentPage==='home'?'text-white font-bold':'text-gray-400'}">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
                                <button onclick="currentPage='settings';render()" class="text-sm ${currentPage==='settings'?'text-white font-bold':'text-gray-400'}">Ø§Ù„Ø§Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
                                ${currentUser.email === ADMIN_EMAIL ? `<button onclick="showUpload=true;render()" class="btn-primary px-5 py-2 rounded-xl text-xs font-bold shadow-lg shadow-purple-500/20">Ø±ÙØ¹ +</button>` : ''}
                                <img src="${currentUser.img}" class="w-10 h-10 rounded-full border border-purple-500/50 p-0.5">
                            ` : `<button onclick="showAuth=true;render()" class="bg-white text-black px-6 py-2 rounded-xl font-bold hover:bg-indigo-50 transition-all shadow-lg shadow-white/10">Ø¯Ø®ÙˆÙ„</button>`}
                        </div>
                    </div>
                </nav>

                <main class="container mx-auto px-6 py-12 min-h-[80vh]">
                    ${!currentUser ? `
                        <div class="text-center py-20 fade-in">
                            <h2 class="text-5xl md:text-7xl font-black mb-6 leading-tight tracking-tighter">Ø¹Ø§Ù„Ù… Ø§Ù„Ø³ÙƒØ±Ø¨ØªØ§Øª <br><span class="text-indigo-500">Ø¨ÙŠÙ† ÙŠØ¯ÙŠÙƒ</span></h2>
                            <p class="text-gray-400 text-lg mb-10 max-w-xl mx-auto">Ø£ÙƒØ¨Ø± Ù…Ù†ØµØ© Ø¹Ø±Ø¨ÙŠØ© Ù„ØªØ­Ù…ÙŠÙ„ Ø³ÙƒØ±Ø¨ØªØ§Øª FiveM Ø§Ù„Ø­ØµØ±ÙŠØ© ÙˆØ§Ù„Ø¢Ù…Ù†Ø© 100%.</p>
                            <button onclick="showAuth=true;render()" class="btn-primary px-12 py-4 rounded-2xl font-black text-xl shadow-xl shadow-purple-500/20">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù† Ù…Ø¬Ø§Ù†Ø§Ù‹</button>
                        </div>
                    ` : (currentPage === 'settings' ? `
                        <div class="max-w-md mx-auto fade-in">
                            <h2 class="text-3xl font-black mb-8 text-center">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨</h2>
                            <div class="glass p-8 rounded-[2.5rem] text-center border border-white/10">
                                <div class="relative w-28 h-28 mx-auto mb-6 group">
                                    <img src="${currentUser.img}" class="w-full h-full rounded-3xl object-cover border-4 border-indigo-500">
                                    <label class="absolute -bottom-2 -right-2 bg-indigo-600 p-2 rounded-full cursor-pointer shadow-lg hover:bg-indigo-500">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path></svg>
                                        <input type="file" class="hidden" accept="image/*" onchange="handleFile(event, 'profile')">
                                    </label>
                                </div>
                                <div class="mb-6">
                                    <input id="set-name" type="text" value="${currentUser.name}" ${currentUser.nameChanged ? 'disabled' : ''} class="w-full bg-white/5 border border-white/10 rounded-xl p-4 text-center outline-none focus:border-indigo-500 ${currentUser.nameChanged?'opacity-50 cursor-not-allowed':''}">
                                    <p class="text-[10px] text-gray-500 mt-2">${currentUser.nameChanged ? 'ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ø§Ø³Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹' : 'ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± Ø§Ø³Ù…Ùƒ Ù„Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·'}</p>
                                </div>
                                ${!currentUser.nameChanged ? `<button onclick="updateProfile(document.getElementById('set-name').value, null)" class="w-full btn-primary py-4 rounded-2xl font-bold mb-4">Ø­ÙØ¸ Ø§Ù„Ø§Ø³Ù…</button>` : ''}
                                <button onclick="logout()" class="w-full bg-red-500/10 text-red-500 py-4 rounded-2xl font-bold hover:bg-red-500 hover:text-white transition-all">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
                            </div>
                        </div>
                    ` : `
                        <div class="flex gap-3 overflow-x-auto pb-8 no-scrollbar">
                            ${['all', 'scripts', 'jobs', 'cars', 'maps'].map(c => `<button onclick="activeCategory='${c}';render()" class="px-6 py-2 rounded-full border text-sm whitespace-nowrap ${activeCategory===c?'bg-indigo-600 border-indigo-400':'glass border-white/10 text-gray-400'} transition-all">${c.toUpperCase()}</button>`).join('')}
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 fade-in">
                            ${filtered.map(s => `
                                <div class="glass rounded-[2rem] border border-white/5 overflow-hidden flex flex-col hover:border-indigo-500/50 hover:scale-[1.02] transition-all">
                                    <div class="h-44 bg-slate-900/50 relative">
                                        ${s.media?.type==='image'?`<img src="${s.media.data}" class="w-full h-full object-cover">`:
                                          s.media?.type==='youtube'?`<div class="w-full h-full flex items-center justify-center text-red-500 text-3xl">â–¶ï¸</div>`:
                                          `<div class="w-full h-full flex items-center justify-center text-gray-700 font-bold">PREVIEW</div>`}
                                    </div>
                                    <div class="p-6">
                                        <h3 class="font-bold mb-4 line-clamp-1">${s.title}</h3>
                                        <div class="flex justify-between text-[11px] text-gray-500 mb-6">
                                            <span>ğŸ‘ï¸ ${s.stats.views || 0}</span>
                                            <span>â¬‡ï¸ ${s.stats.downloads || 0}</span>
                                        </div>
                                        <button onclick="handleView('${s.id}')" class="w-full bg-white/5 hover:bg-white hover:text-black py-3 rounded-xl font-bold text-xs transition-all">Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„</button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `)}
                </main>

                ${showAuth ? `
                    <div class="fixed inset-0 z-[100] flex items-center justify-center p-4 fade-in">
                        <div class="absolute inset-0 bg-black/80 backdrop-blur-md" onclick="showAuth=false;render()"></div>
                        <div class="glass w-full max-w-sm rounded-[2.5rem] p-10 relative text-center border border-white/10 shadow-2xl">
                            <h2 class="text-2xl font-black mb-8 italic tracking-tighter">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ</h2>
                            <button onclick="loginGoogle()" class="w-full bg-white text-black py-4 rounded-2xl font-bold mb-4 flex items-center justify-center gap-3 hover:scale-[1.03] transition-transform">
                                <img src="https://www.google.com/favicon.ico" class="w-5"> Ø¯Ø®ÙˆÙ„ Ø¨Ø¬ÙˆØ¬Ù„
                            </button>
                            <button onclick="loginDiscord()" class="w-full bg-[#5865F2] text-white py-4 rounded-2xl font-bold flex items-center justify-center gap-3 hover:scale-[1.03] transition-transform shadow-lg shadow-[#5865F2]/20">
                                <img src="https://assets-global.website-files.com/6257adef93867e3d8405e904/6257adef93867e83c605e965_discord-logo-white.svg" class="w-6"> Ø¯Ø®ÙˆÙ„ Ø¨Ø¯ÙŠØ³ÙƒÙˆØ±Ø¯
                            </button>
                        </div>
                    </div>
                ` : ''}

                ${showUpload ? `
                    <div class="fixed inset-0 z-[100] flex items-center justify-center p-4 fade-in overflow-y-auto">
                        <div class="absolute inset-0 bg-black/95 backdrop-blur-xl" onclick="showUpload=false;render()"></div>
                        <div class="glass w-full max-w-lg rounded-[2rem] p-8 relative my-auto">
                            <h2 class="text-xl font-bold mb-6">Ø±ÙØ¹ Ø³ÙƒØ±Ø¨Øª Ø¬Ø¯ÙŠØ¯</h2>
                            <div class="space-y-4">
                                <input type="text" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø³ÙƒØ±Ø¨Øª" oninput="uploadForm.title=this.value" class="w-full bg-white/5 border border-white/10 rounded-xl p-4 outline-none text-sm">
                                <textarea placeholder="Ø§Ù„ÙˆØµÙ" oninput="uploadForm.description=this.value" class="w-full bg-white/5 border border-white/10 rounded-xl p-4 h-24 text-sm outline-none"></textarea>
                                <div class="grid grid-cols-2 gap-4 text-xs">
                                    <select onchange="uploadForm.category=this.value" class="bg-slate-800 border border-white/10 rounded-xl p-3 outline-none">
                                        <option value="scripts">Scripts</option><option value="jobs">Jobs</option><option value="cars">Cars</option><option value="maps">Maps</option>
                                    </select>
                                    <input type="file" onchange="uploadForm.file=this.files[0]" class="py-2 text-[10px]">
                                </div>
                                <div class="p-4 bg-white/5 rounded-2xl border border-white/5">
                                    <div class="flex gap-2 mb-4">
                                        ${['none', 'image', 'youtube'].map(t => `<button onclick="uploadForm.mediaType='${t}';render()" class="flex-1 py-2 rounded-xl text-[10px] font-bold ${uploadForm.mediaType===t?'bg-indigo-600':'bg-white/5'} transition-all">${t.toUpperCase()}</button>`).join('')}
                                    </div>
                                    ${uploadForm.mediaType==='image'?`<input type="file" accept="image/*" onchange="handleFile(event, 'upload_img')" class="text-xs text-gray-500">`:''}
                                    ${uploadForm.mediaType==='youtube'?`<input type="text" placeholder="Ø±Ø§Ø¨Ø· ÙŠÙˆØªÙŠÙˆØ¨" oninput="uploadForm.youtubeUrl=this.value" class="w-full bg-slate-900 border border-white/10 rounded-xl p-3 text-xs outline-none focus:border-indigo-500">`:''}
                                </div>
                                <button onclick="submitScript()" class="w-full btn-primary py-4 rounded-xl font-black shadow-lg shadow-purple-500/20">Ù†Ø´Ø± Ø§Ù„Ø³ÙƒØ±Ø¨Øª</button>
                            </div>
                        </div>
                    </div>
                ` : ''}

                ${showDetails ? `
                    <div class="fixed inset-0 z-[100] flex items-center justify-center p-4 fade-in overflow-y-auto">
                        <div class="absolute inset-0 bg-black/95 backdrop-blur-lg" onclick="showDetails=null;render()"></div>
                        <div class="glass w-full max-w-2xl rounded-[2.5rem] p-8 relative my-auto max-h-[90vh]">
                            ${showDetails.media?.type === 'image' ? `<img src="${showDetails.media.data}" class="w-full h-64 object-cover rounded-3xl mb-6 shadow-2xl">` : ''}
                            ${showDetails.media?.type === 'youtube' ? `<div class="aspect-video w-full mb-6 bg-black rounded-3xl overflow-hidden shadow-2xl"><iframe width="100%" height="100%" src="https://www.youtube.com/embed/${showDetails.media.url.split('v=')[1] || showDetails.media.url.split('/').pop()}" frameborder="0" allowfullscreen></iframe></div>` : ''}
                            <h2 class="text-3xl font-black mb-4 tracking-tighter">${showDetails.title}</h2>
                            <p class="text-gray-400 mb-8 leading-relaxed text-sm">${showDetails.description || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ."}</p>
                            <button onclick="window.location.href='${showDetails.fileData}'" download="${showDetails.fileName}" class="w-full btn-primary py-5 rounded-2xl font-black text-xl flex items-center justify-center gap-3">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙƒØ±Ø¨Øª Ø§Ù„Ø¢Ù† â¬‡ï¸</button>
                        </div>
                    </div>
                ` : ''}
            `;
        }

        render();
    </script>
</body>
</html>
