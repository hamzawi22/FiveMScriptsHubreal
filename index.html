<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FiveM Scripts Hub - Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap');
        
        * {
            font-family: 'Cairo', sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: radial-gradient(circle at top right, #1e1b4b, #0f172a, #020617);
            color: #f8fafc;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        .gradient-text {
            background: linear-gradient(to right, #a855f7, #ec4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #4f46e5; border-radius: 10px; }
        
        .btn-discord {
            background-color: #5865F2;
            transition: all 0.3s ease;
        }
        .btn-discord:hover {
            background-color: #4752C4;
            transform: translateY(-2px);
        }

        .line-clamp-1 {
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
        }

        .line-clamp-2 {
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        const ADMIN_EMAIL = 'obywawi@gmail.com';
        const DISCORD_CLIENT_ID = '1454211006866657384';
        const REDIRECT_URI = window.location.origin + window.location.pathname;

        const firebaseConfig = {
            apiKey: "AIzaSyDbW67rYjVnUdzoF9FvfLJypGi_MF9nQjg",
            authDomain: "login-system-124a6.firebaseapp.com",
            projectId: "login-system-124a6",
            storageBucket: "login-system-124a6.firebasestorage.app",
            messagingSenderId: "667998653226",
            appId: "1:667998653226:web:bc4a96a2dbbd22cf386c53",
            measurementId: "G-42NY348NXE"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let currentUser = null;
        let scripts = [];
        let showAuth = false;
        let showUpload = false;
        let currentPage = 'home';
        let currentScriptId = null;
        let activeCategory = 'all';
        let uploadForm = { title: '', description: '', category: 'jobs', mediaType: 'none', youtubeUrl: '' };
        let selectedFile = null;
        let selectedMedia = null;
        let downloadTimer = null;
        let downloadTimeLeft = 60;

        const storage = {
            loadScripts: async () => {
                try {
                    const snapshot = await db.collection('scripts').orderBy('timestamp', 'desc').get();
                    scripts = [];
                    snapshot.forEach(doc => {
                        scripts.push({ id: doc.id, ...doc.data() });
                    });
                    
                    if (scripts.length === 0) {
                        const demoScripts = getDemoScripts();
                        for (const demo of demoScripts) {
                            await db.collection('scripts').doc(demo.id).set({
                                ...demo,
                                timestamp: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        }
                        await storage.loadScripts();
                    }
                } catch (e) {
                    console.error('Ø®Ø·Ø£:', e);
                }
            },
            saveUser: (user) => localStorage.setItem('hub_user', JSON.stringify(user)),
            getUser: () => {
                try {
                    const data = localStorage.getItem('hub_user');
                    return data ? JSON.parse(data) : null;
                } catch (e) {
                    return null;
                }
            },
            clearUser: () => localStorage.removeItem('hub_user'),
            getUserData: (uid) => {
                try {
                    const data = localStorage.getItem('hub_userdata_' + uid);
                    return data ? JSON.parse(data) : null;
                } catch (e) {
                    return null;
                }
            },
            saveUserData: (uid, data) => localStorage.setItem('hub_userdata_' + uid, JSON.stringify(data))
        };

        function getDemoScripts() {
            return [
                {
                    id: 'demo_1',
                    title: 'Police Job Script',
                    description: 'Ø³ÙƒØ±Ø¨Øª ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø´Ø±Ø·Ø© Ø§Ù„ÙƒØ§Ù…Ù„ Ù…Ø¹ Ù†Ø¸Ø§Ù… Ø§Ù„Ø±ØªØ¨ ÙˆØ§Ù„Ù…Ù‡Ø§Ù… ÙˆØ§Ù„Ø¨Ø§ØªØ±ÙˆÙ„.',
                    category: 'jobs',
                    fileName: 'police_job.zip',
                    fileData: 'data:text/plain;base64,VGhpcyBpcyBhIGRlbW8gZmlsZQ==',
                    media: { type: 'youtube', url: 'https://www.youtube.com/watch?v=dQw4w9WgXcQ' },
                    uploader: 'demo@fivem.com',
                    uploaderUid: 'demo_user_1',
                    uploaderName: 'FiveM Scripts',
                    date: new Date(Date.now() - 86400000 * 2).toISOString(),
                    stats: { views: 245, downloads: 89, uniqueDownloads: [] }
                },
                {
                    id: 'demo_2',
                    title: 'Luxury Car Pack',
                    description: 'Ù…Ø¬Ù…ÙˆØ¹Ø© Ø³ÙŠØ§Ø±Ø§Øª ÙØ®Ù…Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ 15 Ø³ÙŠØ§Ø±Ø© Ø¨Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ©.',
                    category: 'cars',
                    fileName: 'luxury_cars.zip',
                    fileData: 'data:text/plain;base64,VGhpcyBpcyBhIGRlbW8gZmlsZQ==',
                    media: { type: 'image', data: 'https://images.unsplash.com/photo-1503376780353-7e6692767b70?w=800' },
                    uploader: 'demo@fivem.com',
                    uploaderUid: 'demo_user_1',
                    uploaderName: 'FiveM Scripts',
                    date: new Date(Date.now() - 86400000 * 5).toISOString(),
                    stats: { views: 567, downloads: 234, uniqueDownloads: [] }
                }
            ];
        }

        async function signInWithGoogle() {
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                await auth.signInWithPopup(provider);
                showAuth = false;
            } catch (error) {
                alert("Ø®Ø·Ø£: " + error.message);
            }
        }

        function signInWithDiscord() {
            const url = `https://discord.com/api/oauth2/authorize?client_id=${DISCORD_CLIENT_ID}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&response_type=token&scope=identify%20email`;
            window.location.href = url;
        }

        async function handleDiscordCallback() {
            const fragment = new URLSearchParams(window.location.hash.slice(1));
            const token = fragment.get('access_token');
            if (token) {
                try {
                    const res = await fetch('https://discord.com/api/users/@me', {
                        headers: { Authorization: `Bearer ${token}` }
                    });
                    const data = await res.json();
                    currentUser = {
                        uid: 'ds_' + data.id,
                        username: data.global_name || data.username,
                        email: data.email || `${data.username}@discord.link`,
                        picture: data.avatar ? `https://cdn.discordapp.com/avatars/${data.id}/${data.avatar}.png` : 'https://cdn.discordapp.com/embed/avatars/0.png',
                        provider: 'discord'
                    };
                    let userData = storage.getUserData(currentUser.uid);
                    if (!userData) {
                        userData = { nameChanged: false, customName: null };
                        storage.saveUserData(currentUser.uid, userData);
                    }
                    currentUser.userData = userData;
                    storage.saveUser(currentUser);
                    window.location.hash = '';
                    render();
                } catch (e) { console.error(e); }
            }
        }

        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = {
                    uid: user.uid,
                    username: user.displayName,
                    email: user.email,
                    picture: user.photoURL,
                    provider: 'google'
                };
                let userData = storage.getUserData(user.uid);
                if (!userData) {
                    userData = { nameChanged: false, customName: null };
                    storage.saveUserData(user.uid, userData);
                }
                currentUser.userData = userData;
                storage.saveUser(currentUser);
            } else {
                const localUser = storage.getUser();
                if (localUser && localUser.provider === 'discord') {
                    currentUser = localUser;
                    let userData = storage.getUserData(localUser.uid);
                    if (!userData) {
                        userData = { nameChanged: false, customName: null };
                        storage.saveUserData(localUser.uid, userData);
                    }
                    currentUser.userData = userData;
                } else {
                    currentUser = null;
                }
            }
            render();
        });

        function logout() {
            auth.signOut();
            storage.clearUser();
            currentUser = null;
            location.reload();
        }

        function handleFile(e) {
            selectedFile = e.target.files[0];
            render();
        }

        function handleMedia(e) {
            selectedMedia = e.target.files[0];
            render();
        }

        function submitScript() {
            if (!selectedFile) return alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø§Ù„Ø³ÙƒØ±Ø¨Øª");
            if (!uploadForm.title || !uploadForm.description) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

            const reader = new FileReader();
            reader.onload = (event) => {
                let mediaData = null;
                if (uploadForm.mediaType === 'image' && selectedMedia) {
                    const mediaReader = new FileReader();
                    mediaReader.onload = (e) => {
                        mediaData = { type: 'image', data: e.target.result };
                        saveScriptData(event.target.result, mediaData);
                    };
                    mediaReader.readAsDataURL(selectedMedia);
                } else if (uploadForm.mediaType === 'youtube' && uploadForm.youtubeUrl) {
                    mediaData = { type: 'youtube', url: uploadForm.youtubeUrl };
                    saveScriptData(event.target.result, mediaData);
                } else {
                    saveScriptData(event.target.result, null);
                }
            };
            reader.readAsDataURL(selectedFile);
        }

        function saveScriptData(fileData, mediaData) {
            const scriptData = {
                title: uploadForm.title,
                description: uploadForm.description,
                category: uploadForm.category,
                fileName: selectedFile.name,
                fileData: fileData,
                media: mediaData,
                uploader: currentUser.email,
                uploaderUid: currentUser.uid,
                uploaderName: currentUser.userData?.customName || currentUser.username,
                date: new Date().toISOString(),
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                stats: { views: 0, downloads: 0, uniqueDownloads: [] }
            };

            db.collection('scripts').add(scriptData)
                .then(() => {
                    showUpload = false;
                    resetUpload();
                    alert("âœ… ØªÙ… Ù†Ø´Ø± Ø§Ù„Ø³ÙƒØ±Ø¨Øª Ø¨Ù†Ø¬Ø§Ø­!");
                    storage.loadScripts().then(() => {
                        currentPage = 'home';
                        activeCategory = 'all';
                        render();
                    });
                })
                .catch((error) => {
                    console.error(error);
                    alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù†Ø´Ø± Ø§Ù„Ø³ÙƒØ±Ø¨Øª');
                });
        }

        function viewDetails(scriptId) {
            currentScriptId = scriptId;
            const script = scripts.find(s => s.id === scriptId);
            if (script) {
                script.stats.views++;
                db.collection('scripts').doc(scriptId).update({
                    'stats.views': script.stats.views
                });
                currentPage = 'scriptDetails';
                downloadTimer = null;
                downloadTimeLeft = 60;
                window.scrollTo(0, 0);
                render();
            }
        }

        function startDownloadTimer() {
            downloadTimeLeft = 60;
            render();
            downloadTimer = setInterval(() => {
                downloadTimeLeft--;
                const timerEl = document.querySelector('.timer-number');
                const circleEl = document.querySelector('.timer-circle');
                if (timerEl) timerEl.textContent = downloadTimeLeft;
                if (circleEl) {
                    const offset = 2 * Math.PI * 70 * (1 - downloadTimeLeft / 60);
                    circleEl.style.strokeDashoffset = offset;
                }
                if (downloadTimeLeft <= 0) {
                    clearInterval(downloadTimer);
                    downloadTimer = null;
                    render();
                }
            }, 1000);
        }

        function actionDownload(id) {
            const s = scripts.find(x => x.id === id);
            if (!s) return alert("âŒ Ø§Ù„Ø³ÙƒØ±Ø¨Øª ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");
            if (!currentUser) return alert("âŒ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
            if (s.stats.uniqueDownloads.includes(currentUser.uid)) return alert("âš ï¸ Ù„Ù‚Ø¯ Ù‚Ù…Øª Ø¨ØªØ­Ù…ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø³ÙƒØ±Ø¨Øª Ù…Ø³Ø¨Ù‚Ø§Ù‹");

            s.stats.uniqueDownloads.push(currentUser.uid);
            s.stats.downloads++;
            
            db.collection('scripts').doc(id).update({
                'stats.downloads': s.stats.downloads,
                'stats.uniqueDownloads': firebase.firestore.FieldValue.arrayUnion(currentUser.uid)
            }).then(() => {
                const link = document.createElement('a');
                link.href = s.fileData;
                link.download = s.fileName;
                link.style.display = 'none';
                document.body.appendChild(link);
                link.click();
                setTimeout(() => document.body.removeChild(link), 1000);
                alert(`âœ… ØªÙ… Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙƒØ±Ø¨Øª:\n${s.title}`);
                setTimeout(() => goHome(), 2000);
            });
        }

        function updateUserName(newName) {
            if (!currentUser || !newName) return;
            const userData = storage.getUserData(currentUser.uid);
            if (userData.nameChanged) return alert("âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± Ø§Ù„Ø§Ø³Ù… Ù…Ø±Ø© Ø£Ø®Ø±Ù‰");
            userData.customName = newName;
            userData.nameChanged = true;
            storage.saveUserData(currentUser.uid, userData);
            currentUser.userData = userData;
            storage.saveUser(currentUser);
            alert("âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³Ù… Ø¨Ù†Ø¬Ø§Ø­!");
            render();
        }

        function resetUpload() {
            uploadForm = { title: '', description: '', category: 'jobs', mediaType: 'none', youtubeUrl: '' };
            selectedFile = null;
            selectedMedia = null;
        }

        function goHome() {
            currentPage = 'home';
            currentScriptId = null;
            if (downloadTimer) {
                clearInterval(downloadTimer);
                downloadTimer = null;
            }
            render();
        }

        function render() {
            const app = document.getElementById('app');
            const isAdmin = currentUser?.email === ADMIN_EMAIL;
            const filtered = activeCategory === 'all' ? scripts : scripts.filter(s => s.category === activeCategory);
            const displayName = currentUser?.userData?.customName || currentUser?.username;
            const currentScript = currentScriptId ? scripts.find(s => s.id === currentScriptId) : null;

            app.innerHTML = `
                <nav class="glass-card sticky top-0 z-[100] px-6 py-4 border-b border-white/5">
                    <div class="container mx-auto flex justify-between items-center">
                        <div class="flex items-center gap-4 cursor-pointer" onclick="goHome()">
                            <div class="bg-gradient-to-br from-purple-600 to-pink-600 p-2 rounded-xl shadow-lg">
                                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg>
                            </div>
                            <span class="text-2xl font-black gradient-text">FIVEM HUB</span>
                        </div>
                        <div class="flex items-center gap-6">
                            ${currentUser ? `
                                <button onclick="goHome()" class="hidden md:block px-4 py-2 rounded-xl ${currentPage === 'home' ? 'bg-purple-600 font-bold' : 'text-gray-400 hover:text-white'} transition-all">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
                                <button onclick="currentPage='settings';currentScriptId=null;render()" class="hidden md:block px-4 py-2 rounded-xl ${currentPage === 'settings' ? 'bg-purple-600 font-bold' : 'text-gray-400 hover:text-white'} transition-all">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
                                <div class="flex items-center gap-3">
                                    <img src="${currentUser.picture}" class="w-10 h-10 rounded-full border-2 border-purple-500/50">
                                    ${isAdmin ? `<button onclick="showUpload=true;render()" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg text-sm font-bold transition-all">â• Ø±ÙØ¹</button>` : ''}
                                </div>
                            ` : `
                                <button onclick="showAuth=true;render()" class="bg-white text-slate-900 px-6 py-2 rounded-xl font-black hover:bg-purple-50 transition-all">Ø¯Ø®ÙˆÙ„</button>
                            `}
                        </div>
                    </div>
                </nav>

                ${!currentUser ? `
                    <section class="container mx-auto px-6 py-24 text-center">
                        <h1 class="text-5xl md:text-8xl font-black mb-8">Ø³ÙŠØ±ÙØ±Ùƒ ÙŠØ³ØªØ­Ù‚ <br><span class="gradient-text italic">Ø§Ù„Ø£ÙØ¶Ù„ Ø¯Ø§Ø¦Ù…Ø§Ù‹</span></h1>
                        <p class="text-gray-400 text-xl max-w-2xl mx-auto mb-12">ØªØ­Ù…ÙŠÙ„ Ø³ÙƒØ±Ø¨ØªØ§Øª FiveM Ø§Ù„Ø­ØµØ±ÙŠØ© Ù…Ø¬Ø§Ù†Ø§Ù‹</p>
                        <button onclick="showAuth=true;render()" class="bg-purple-600 px-12 py-5 rounded-2xl font-black text-2xl hover:scale-105 transition-all shadow-2xl">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†</button>
                    </section>
                ` : currentPage === 'home' ? `
                    <div class="container mx-auto px-6 mt-10">
                        <div class="flex gap-4 overflow-x-auto pb-4">
                            ${['all', 'jobs', 'cars', 'maps', 'scripts', 'other'].map(cat => `
                                <button onclick="activeCategory='${cat}';render()" class="px-8 py-3 rounded-2xl border transition-all ${activeCategory === cat ? 'bg-purple-600 border-purple-400 font-bold' : 'border-white/10 glass-card text-gray-400'}">
                                    ${cat === 'all' ? 'Ø§Ù„ÙƒÙ„' : cat.charAt(0).toUpperCase() + cat.slice(1)}
                                </button>
                            `).join('')}
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mt-12 mb-20">
                            ${filtered.map(s => {
                                let mediaHtml = '';
                                if (s.media?.type === 'image') {
                                    mediaHtml = `<img src="${s.media.data}" class="w-full h-36 object-cover rounded-t-[24px]">`;
                                } else if (s.media?.type === 'youtube') {
                                    const videoId = s.media.url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&]+)/)?.[1];
                                    if (videoId) mediaHtml = `<img src="https://img.youtube.com/vi/${videoId}/maxresdefault.jpg" class="w-full h-36 object-cover rounded-t-[24px]">`;
                                }
                                return `
                                <div class="glass-card rounded-[24px] overflow-hidden border border-white/5 hover:border-purple-500/40 transition-all cursor-pointer" onclick="viewDetails('${s.id}')">
                                    ${mediaHtml}
                                    <div class="p-5">
                                        <div class="flex justify-between items-center mb-3">
                                            <span class="bg-purple-600/20 text-purple-400 text-[9px] font-black px-2 py-1 rounded-full uppercase">${s.category}</span>
                                            <span class="text-[9px] text-gray-500">${new Date(s.date).toLocaleDateString('ar-EG')}</span>
                                        </div>
                                        <h3 class="text-lg font-bold mb-2 line-clamp-1">${s.title}</h3>
                                        <p class="text-gray-400 text-xs mb-4 line-clamp-2">${s.description}</p>
                                        <div class="flex items-center gap-4 mb-4 text-[10px] text-gray-500 border-y border-white/5 py-2">
                                            <div>ğŸ‘ï¸ <span class="font-bold text-white">${s.stats.views}</span></div>
                                            <div>â¬‡ï¸ <span class="font-bold text-white">${s.stats.downloads}</span></div>
                                        </div>
                                        <button class="w-full bg-white text-black py-2.5 rounded-xl text-sm font-black hover:bg-purple-600 hover:text-white transition-all">Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„</button>
                                    </div>
                                </div>
                            `}).join('')}
                        </div>
                    </div>
                ` : currentPage === 'scriptDetails' && currentScript ? `
                    <div class="container mx-auto px-6 mt-10 mb-20">
                        <button onclick="goHome()" class="mb-8 flex items-center gap-2 text-gray-400 hover:text-white">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                            Ø§Ù„Ø¹ÙˆØ¯Ø©
                        </button>
                        <div class="max-w-5xl mx-auto">
                            ${currentScript.media ? (() => {
                                if (currentScript.media.type === 'image') {
                                    return `<img src="${currentScript.media.data}" class="w-full h-[500px] object-cover rounded-[40px] mb-10 shadow-2xl">`;
                                } else if (currentScript.media.type === 'youtube') {
                                    const videoId = currentScript.media.url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&]+)/)?.[1];
                                    if (videoId) return `<iframe src="https://www.youtube.com/embed/${videoId}" class="w-full h-[500px] rounded-[40px] mb-10" frameborder="0" allowfullscreen></iframe>`;
                                }
                                return '';
                            })() : ''}
                            <div class="glass-card rounded-[40px] p-10 mb-8">
                                <h1 class="text-5xl font-black mb-6">${currentScript.title}</h1>
                                <p class="text-gray-300 text-xl mb-10">${currentScript.description}</p>
                                ${downloadTimer === null && !currentScript.stats.uniqueDownloads.includes(currentUser?.uid) ? `
                                    <button onclick="startDownloadTimer()" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-8 rounded-3xl font-black text-2xl transition-all">ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„</button>
                                ` : currentScript.stats.uniqueDownloads.includes(currentUser?.uid) ? `
                                    <div class="bg-yellow-500/10 border border-yellow-500/30 rounded-3xl p-8 text-center">
                                        <div class="text-5xl mb-4">âš ï¸</div>
                                        <div class="text-yellow-400 font-bold text-2xl">Ù„Ù‚Ø¯ Ù‚Ù…Øª Ø¨ØªØ­Ù…ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø³ÙƒØ±Ø¨Øª Ù…Ù† Ù‚Ø¨Ù„</div>
                                    </div>
                                ` : downloadTimeLeft > 0 ? `
                                    <div class="bg-gradient-to-r from-purple-600/20 to-pink-600/20 rounded-3xl p-12 text-center">
                                        <div class="relative w-40 h-40 mx-auto mb-8">
                                            <svg class="transform -rotate-90 w-40 h-40">
                                                <circle cx="80" cy="80" r="70" stroke="rgba(255,255,255,0.1)" stroke-width="10" fill="none" />
                                                <circle cx="80" cy="80" r="70" stroke="#a855f7" stroke-width="10" fill="none" class="timer-circle" stroke-dasharray="${2 * Math.PI * 70}" stroke-dashoffset="${2 * Math.PI * 70 * (1 - downloadTimeLeft / 60)}" />
                                            </svg>
                                            <div class="absolute inset-0 flex items-center justify-center">
                                                <span class="text-5xl font-black timer-number">${downloadTimeLeft}</span>
                                            </div>
                                        </div>
                                        <div class="text-2xl font-bold mb-3">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...</div>
                                    </div>
                                ` : `
                                    <button onclick="actionDownload('${currentScript.id}')" class="w-full bg-green-600 hover:bg-green-700 text-white py-8 rounded-3xl font-black text-2xl transition-all">âœ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¢Ù†</button>
                                `}
                            </div>
                        </div>
                    </div>
                ` : `
                    <div class="container mx-auto px-6 mt-10 mb-20">
                        <div class="max-w-3xl mx-auto">
                            <h2 class="text-4xl font-black mb-10">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª âš™ï¸</h2>
                            <div class="glass-card rounded-[40px] p-10 mb-8">
                                <h3 class="text-2xl font-bold mb-6">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨</h3>
                                <div class="flex items-center gap-6 mb-8">
                                    <img src="${currentUser.picture}" class="w-24 h-24 rounded-3xl border-4 border-purple-500/50">
                                    <div>
                                        <h4 class="text-xl font-bold mb-2">${displayName}</h4>
                                        <p class="text-gray-400 text-sm">${currentUser.email}</p>
                                    </div>
                                </div>
                                <div class="border-t border-white/10 pt-8">
                                    <h4 class="text-sm font-black text-gray-500 uppercase mb-4">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø³Ù…</h4>
                                    ${!currentUser.userData.nameChanged ? `
                                        <div class="flex gap-4">
                                            <input type="text" id="newName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯" class="flex-1 bg-white/5 border border-white/10 rounded-2xl px-6 py-3 outline-none focus:border-purple-500">
                                            <button onclick="updateUserName(document.getElementById('newName').value)" class="bg-purple-600 hover:bg-purple-700 px-8 py-3 rounded-2xl font-black">Ø­ÙØ¸</button>
                                        </div>
                                        <p class="text-yellow-400 text-xs mt-3 font-bold">âš ï¸ ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± Ø§Ù„Ø§Ø³Ù… Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·!</p>
                                    ` : `
                                        <p class="text-gray-400 text-sm">âœ… Ù„Ù‚Ø¯ Ù‚Ù…Øª Ø¨ØªØºÙŠÙŠØ± Ø§Ø³Ù…Ùƒ Ù…Ù† Ù‚Ø¨Ù„</p>
                                    `}
                                </div>
                            </div>
                            <div class="glass-card rounded-[40px] p-10">
                                <button onclick="if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ')) logout()" class="w-full bg-red-600/20 hover:bg-red-600/30 border border-red-500/50 text-red-400 py-4 rounded-2xl font-black">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
                            </div>
                        </div>
                    </div>
                `}

                ${showAuth ? `
                    <div class="fixed inset-0 z-[200] flex items-center justify-center p-4">
                        <div class="absolute inset-0 bg-slate-950/90 backdrop-blur-md" onclick="showAuth=false;render()"></div>
                        <div class="glass-card w-full max-w-md rounded-[45px] p-12 relative">
                            <h2 class="text-3xl font-black mb-8 text-center">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ!</h2>
                            <div class="space-y-4">
                                <button onclick="signInWithGoogle()" class="w-full bg-white text-black py-4 rounded-2xl font-black flex items-center justify-center gap-3 hover:bg-gray-200">
                                    <img src="https://www.google.com/favicon.ico" class="w-5">
                                    Ø¨ÙˆØ§Ø³Ø·Ø© Ø¬ÙˆØ¬Ù„
                                </button>
                                <button onclick="signInWithDiscord()" class="btn-discord w-full text-white py-4 rounded-2xl font-black flex items-center justify-center gap-3">
                                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.06.06 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.158-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.966 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.158-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.946 2.418-2.157 2.418z"/></svg>
                                    Ø¨ÙˆØ§Ø³Ø·Ø© Ø¯ÙŠØ³ÙƒÙˆØ±Ø¯
                                </button>
                            </div>
                        </div>
                    </div>
                ` : ''}

                ${showUpload ? `
                    <div class="fixed inset-0 z-[200] flex items-center justify-center p-4 overflow-y-auto">
                        <div class="absolute inset-0 bg-slate-950/90 backdrop-blur-md" onclick="showUpload=false;resetUpload();render()"></div>
                        <div class="glass-card w-full max-w-2xl rounded-[40px] p-10 relative my-8">
                            <h2 class="text-3xl font-black mb-8">Ù†Ø´Ø± Ø³ÙƒØ±Ø¨Øª Ø¬Ø¯ÙŠØ¯ ğŸš€</h2>
                            <div class="space-y-6">
                                <input type="text" value="${uploadForm.title}" oninput="uploadForm.title=this.value" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†" class="w-full bg-white/5 border border-white/10 rounded-2xl px-6 py-4 outline-none focus:border-purple-500">
                                <textarea oninput="uploadForm.description=this.value" placeholder="Ø§Ù„ÙˆØµÙ" class="w-full bg-white/5 border border-white/10 rounded-2xl px-6 py-4 h-32 outline-none focus:border-purple-500">${uploadForm.description}</textarea>
                                <div>
                                    <label class="block mb-2 text-sm font-bold">Ø§Ù„ØµÙˆØ±Ø© Ø£Ùˆ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</label>
                                    <div class="flex gap-4 mb-4">
                                        <button onclick="uploadForm.mediaType='none';render()" class="flex-1 py-3 rounded-xl border ${uploadForm.mediaType === 'none' ? 'bg-purple-600' : 'border-white/10'}">Ø¨Ø¯ÙˆÙ†</button>
                                        <button onclick="uploadForm.mediaType='image';render()" class="flex-1 py-3 rounded-xl border ${uploadForm.mediaType === 'image' ? 'bg-purple-600' : 'border-white/10'}">ØµÙˆØ±Ø©</button>
                                        <button onclick="uploadForm.mediaType='youtube';render()" class="flex-1 py-3 rounded-xl border ${uploadForm.mediaType === 'youtube' ? 'bg-purple-600' : 'border-white/10'}">ÙŠÙˆØªÙŠÙˆØ¨</button>
                                    </div>
                                    ${uploadForm.mediaType === 'image' ? `<input type="file" accept="image/*" onchange="handleMedia(event)" class="w-full text-xs py-3">` : ''}
                                    ${uploadForm.mediaType === 'youtube' ? `<input type="text" value="${uploadForm.youtubeUrl}" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨" oninput="uploadForm.youtubeUrl=this.value" class="w-full bg-white/5 border border-white/10 rounded-2xl px-6 py-4 outline-none focus:border-purple-500">` : ''}
                                </div>
                                <select onchange="uploadForm.category=this.value" class="w-full bg-slate-800 border border-white/10 rounded-2xl px-6 py-4">
                                    <option value="jobs" ${uploadForm.category === 'jobs' ? 'selected' : ''}>Jobs</option>
                                    <option value="cars" ${uploadForm.category === 'cars' ? 'selected' : ''}>Cars</option>
                                    <option value="maps" ${uploadForm.category === 'maps' ? 'selected' : ''}>Maps</option>
                                    <option value="scripts" ${uploadForm.category === 'scripts' ? 'selected' : ''}>Scripts</option>
                                    <option value="other" ${uploadForm.category === 'other' ? 'selected' : ''}>Other</option>
                                </select>
                                <input type="file" onchange="handleFile(event)" class="w-full text-xs py-3">
                                ${selectedFile ? `<p class="text-green-400 text-xs">âœ… ${selectedFile.name}</p>` : ''}
                                <div class="flex gap-4 pt-6">
                                    <button onclick="submitScript()" class="flex-1 bg-gradient-to-r from-purple-600 to-pink-600 py-4 rounded-2xl font-black">Ù†Ø´Ø±</button>
                                    <button onclick="showUpload=false;resetUpload();render()" class="px-8 py-4 bg-white/5 rounded-2xl font-bold">Ø¥Ù„ØºØ§Ø¡</button>
                                </div>
                            </div>
                        </div>
                    </div>
                ` : ''}
            `;
        }

        db.collection('scripts').onSnapshot((snapshot) => {
            scripts = [];
            snapshot.forEach(doc => {
                scripts.push({ id: doc.id, ...doc.data() });
            });
            scripts.sort((a, b) => {
                const dateA = a.timestamp?.toDate() || new Date(a.date);
                const dateB = b.timestamp?.toDate() || new Date(b.date);
                return dateB - dateA;
            });
            render();
        });

        window.onload = async () => {
            handleDiscordCallback();
            await storage.loadScripts();
            render();
        };
    </script>
</body>
</html>
