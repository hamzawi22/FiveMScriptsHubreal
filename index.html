<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FiveM Scripts Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap');
        * { font-family: 'Cairo', sans-serif; margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: linear-gradient(135deg, #0a0118 0%, #1a0b2e 50%, #2d1b4e 100%);
            color: #f8fafc; 
            min-height: 100vh;
        }
        .glass { 
            background: rgba(10, 1, 24, 0.6); 
            backdrop-filter: blur(20px);
            border: 1px solid rgba(147, 51, 234, 0.2);
        }
        .btn-primary { 
            background: linear-gradient(135deg, #9333ea 0%, #c026d3 100%);
            transition: all 0.3s;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(147, 51, 234, 0.4);
        }
        .gradient-text {
            background: linear-gradient(135deg, #9333ea, #c026d3);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .card-hover {
            transition: all 0.3s;
        }
        .card-hover:hover {
            transform: translateY(-8px);
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        const ADMIN_EMAIL = 'obywawi@gmail.com';
        
        let state = {
            currentUser: null,
            showAuth: false,
            authMode: 'login',
            currentPage: 'home',
            activeCategory: 'all',
            selectedScript: null,
            showUpload: false,
            scripts: [],
            emailForm: { email: '', password: '' },
            uploadForm: { title: '', description: '', category: 'scripts', file: null, image: null }
        };

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙƒØ±Ø¨ØªØ§Øª Ù…Ù† Storage
        async function loadScripts() {
            try {
                const result = await window.storage.list('script:', true);
                if (!result?.keys) return [];
                
                const scripts = [];
                for (const key of result.keys) {
                    try {
                        const data = await window.storage.get(key, true);
                        if (data?.value) {
                            scripts.push(JSON.parse(data.value));
                        }
                    } catch (e) {
                        console.log('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„:', key);
                    }
                }
                return scripts.sort((a, b) => new Date(b.date) - new Date(a.date));
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙƒØ±Ø¨ØªØ§Øª:', error);
                return [];
            }
        }

        // Ø­ÙØ¸ Ø³ÙƒØ±Ø¨Øª Ø¬Ø¯ÙŠØ¯
        async function saveScript(script) {
            try {
                const key = `script:${script.id}`;
                await window.storage.set(key, JSON.stringify(script), true);
                return true;
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸:', error);
                alert('ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ø³ÙƒØ±Ø¨Øª: ' + error.message);
                return false;
            }
        }

        // Ø­Ø°Ù Ø³ÙƒØ±Ø¨Øª
        async function deleteScript(id) {
            if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³ÙƒØ±Ø¨ØªØŸ')) return;
            try {
                await window.storage.delete(`script:${id}`, true);
                state.selectedScript = null;
                state.currentPage = 'home';
                await init();
                alert('ØªÙ… Ø§Ù„Ø­Ø°Ù âœ“');
            } catch (error) {
                alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù');
            }
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø¨Ø³ÙŠØ· (Ø¨Ø¯ÙˆÙ† Firebase)
        function loginUser() {
            const { email, password } = state.emailForm;
            if (!email || !password) {
                alert('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±');
                return;
            }
            
            // Ø­ÙØ¸ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø­Ù„ÙŠØ§Ù‹
            const user = {
                uid: 'user_' + Date.now(),
                email: email,
                name: email.split('@')[0],
                img: `https://ui-avatars.com/api/?name=${encodeURIComponent(email)}&background=9333ea&color=fff`
            };
            
            localStorage.setItem('fivem_user', JSON.stringify(user));
            state.currentUser = user;
            state.showAuth = false;
            state.emailForm = { email: '', password: '' };
            render();
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        function logout() {
            localStorage.removeItem('fivem_user');
            state.currentUser = null;
            state.currentPage = 'home';
            render();
        }

        // Ø±ÙØ¹ Ù…Ù„Ù ÙƒØµÙˆØ±Ø©
        function handleImageUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (ev) => {
                state.uploadForm.image = ev.target.result;
                render();
            };
            reader.readAsDataURL(file);
        }

        // Ø±ÙØ¹ Ù…Ù„Ù Ø§Ù„Ø³ÙƒØ±Ø¨Øª
        function handleFileUpload(e) {
            state.uploadForm.file = e.target.files[0];
            render();
        }

        // Ù†Ø´Ø± Ø³ÙƒØ±Ø¨Øª Ø¬Ø¯ÙŠØ¯
        async function submitScript() {
            const { title, description, category, file, image } = state.uploadForm;
            
            if (!title || !file) {
                alert('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ø®ØªØ± Ø§Ù„Ù…Ù„Ù');
                return;
            }

            const reader = new FileReader();
            reader.onload = async (e) => {
                const script = {
                    id: Date.now().toString(),
                    title,
                    description,
                    category,
                    fileData: e.target.result,
                    fileName: file.name,
                    image: image || null,
                    stats: { views: 0, downloads: 0 },
                    date: new Date().toISOString(),
                    author: state.currentUser?.name || 'Ù…Ø¬Ù‡ÙˆÙ„'
                };

                const saved = await saveScript(script);
                if (saved) {
                    state.showUpload = false;
                    state.uploadForm = { title: '', description: '', category: 'scripts', file: null, image: null };
                    alert('ØªÙ… Ø§Ù„Ù†Ø´Ø± âœ“');
                    await init();
                }
            };
            reader.readAsDataURL(file);
        }

        // Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø³ÙƒØ±Ø¨Øª
        async function viewScript(id) {
            const script = state.scripts.find(s => s.id === id);
            if (script) {
                // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª
                script.stats.views++;
                await saveScript(script);
                
                state.selectedScript = script;
                state.currentPage = 'details';
                await init();
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø³ÙƒØ±Ø¨Øª
        async function downloadScript(id) {
            const script = state.scripts.find(s => s.id === id);
            if (script) {
                script.stats.downloads++;
                await saveScript(script);
                await init();
            }
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        async function init() {
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø­ÙÙˆØ¸
            const savedUser = localStorage.getItem('fivem_user');
            if (savedUser) {
                state.currentUser = JSON.parse(savedUser);
            }

            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙƒØ±Ø¨ØªØ§Øª
            state.scripts = await loadScripts();
            render();
        }

        // Ø¹Ø±Ø¶ Ø§Ù„ØµÙØ­Ø©
        function render() {
            const app = document.getElementById('app');
            const filtered = state.activeCategory === 'all' 
                ? state.scripts 
                : state.scripts.filter(s => s.category === state.activeCategory);

            // ØµÙØ­Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„
            if (state.currentPage === 'details' && state.selectedScript) {
                const s = state.selectedScript;
                app.innerHTML = `
                    <nav class="glass px-6 py-4 sticky top-0 z-50">
                        <div class="max-w-7xl mx-auto flex justify-between items-center">
                            <h1 class="text-2xl font-bold gradient-text cursor-pointer" onclick="state.currentPage='home';state.selectedScript=null;render()">
                                âš¡ FIVEM HUB
                            </h1>
                            <button onclick="state.currentPage='home';state.selectedScript=null;render()" class="text-gray-400 hover:text-white">
                                â† Ø§Ù„Ø¹ÙˆØ¯Ø©
                            </button>
                        </div>
                    </nav>

                    <div class="max-w-6xl mx-auto px-6 py-12">
                        ${s.image ? `
                            <img src="${s.image}" class="w-full h-96 object-cover rounded-3xl mb-8 shadow-2xl">
                        ` : ''}

                        <div class="glass rounded-3xl p-10 mb-8">
                            <h1 class="text-5xl font-black mb-6 gradient-text">${s.title}</h1>
                            
                            <div class="flex gap-4 mb-8">
                                <span class="bg-purple-600 px-4 py-2 rounded-full text-sm font-bold">
                                    ${s.category.toUpperCase()}
                                </span>
                                <span class="text-gray-400">ğŸ‘¤ ${s.author}</span>
                                <span class="text-gray-400">ğŸ“… ${new Date(s.date).toLocaleDateString('ar-SA')}</span>
                            </div>

                            <div class="grid grid-cols-3 gap-4 mb-8">
                                <div class="bg-purple-900/30 rounded-2xl p-6 text-center">
                                    <div class="text-3xl font-bold text-purple-400">${s.stats.views}</div>
                                    <div class="text-sm text-gray-400">Ù…Ø´Ø§Ù‡Ø¯Ø©</div>
                                </div>
                                <div class="bg-pink-900/30 rounded-2xl p-6 text-center">
                                    <div class="text-3xl font-bold text-pink-400">${s.stats.downloads}</div>
                                    <div class="text-sm text-gray-400">ØªØ­Ù…ÙŠÙ„</div>
                                </div>
                                <div class="bg-blue-900/30 rounded-2xl p-6 text-center">
                                    <div class="text-lg font-bold text-blue-400">${s.fileName.split('.').pop().toUpperCase()}</div>
                                    <div class="text-sm text-gray-400">Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù</div>
                                </div>
                            </div>

                            <div class="bg-slate-900/40 rounded-2xl p-6 mb-8">
                                <h3 class="text-xl font-bold mb-4 text-purple-300">ğŸ“ Ø§Ù„ÙˆØµÙ</h3>
                                <p class="text-gray-300 leading-relaxed">${s.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ'}</p>
                            </div>

                            <div class="flex gap-4">
                                <a href="${s.fileData}" download="${s.fileName}" onclick="downloadScript('${s.id}')" class="flex-1 btn-primary py-4 rounded-2xl font-bold text-center">
                                    â¬‡ï¸ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙƒØ±Ø¨Øª
                                </a>
                                ${state.currentUser?.email === ADMIN_EMAIL ? `
                                    <button onclick="deleteScript('${s.id}')" class="bg-red-500/20 text-red-400 px-8 py-4 rounded-2xl font-bold hover:bg-red-500 hover:text-white">
                                        ğŸ—‘ï¸ Ø­Ø°Ù
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
                return;
            }

            // Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            app.innerHTML = `
                <nav class="glass px-6 py-4 sticky top-0 z-50">
                    <div class="max-w-7xl mx-auto flex justify-between items-center">
                        <h1 class="text-2xl font-bold gradient-text cursor-pointer" onclick="state.currentPage='home';render()">
                            âš¡ FIVEM HUB
                        </h1>
                        <div class="flex items-center gap-4">
                            ${state.currentUser ? `
                                <span class="text-sm text-gray-400">Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ ${state.currentUser.name}</span>
                                ${state.currentUser.email === ADMIN_EMAIL ? `
                                    <button onclick="state.showUpload=true;render()" class="btn-primary px-6 py-2 rounded-xl text-sm font-bold">
                                        + Ø±ÙØ¹ Ø³ÙƒØ±Ø¨Øª
                                    </button>
                                ` : ''}
                                <button onclick="logout()" class="text-sm text-red-400 hover:text-red-300">
                                    ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
                                </button>
                            ` : `
                                <button onclick="state.showAuth=true;render()" class="btn-primary px-8 py-3 rounded-xl font-bold">
                                    ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                                </button>
                            `}
                        </div>
                    </div>
                </nav>

                <main class="max-w-7xl mx-auto px-6 py-12">
                    ${!state.currentUser ? `
                        <div class="text-center py-20">
                            <div class="text-8xl mb-8">ğŸ®</div>
                            <h2 class="text-6xl font-black mb-6">
                                Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ <span class="gradient-text">FiveM Hub</span>
                            </h2>
                            <p class="text-gray-400 text-xl mb-10 max-w-2xl mx-auto">
                                Ø£ÙØ¶Ù„ Ù…Ù†ØµØ© Ù„ØªØ­Ù…ÙŠÙ„ Ø³ÙƒØ±Ø¨ØªØ§Øª FiveM Ù…Ø¬Ø§Ù†Ø§Ù‹
                            </p>
                            <button onclick="state.showAuth=true;render()" class="btn-primary px-16 py-5 rounded-2xl font-bold text-2xl">
                                Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù† â†’
                            </button>
                        </div>
                    ` : `
                        <div class="mb-10">
                            <h2 class="text-4xl font-black mb-6 gradient-text">Ø§Ù„Ø³ÙƒØ±Ø¨ØªØ§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©</h2>
                            <div class="flex gap-3 mb-8">
                                ${['all', 'scripts', 'jobs', 'cars', 'maps'].map(c => `
                                    <button onclick="state.activeCategory='${c}';render()" class="px-6 py-3 rounded-xl font-bold ${state.activeCategory===c?'bg-purple-600':'glass'} hover:bg-purple-600 transition-all">
                                        ${c === 'all' ? 'ğŸŒŸ Ø§Ù„ÙƒÙ„' : c === 'scripts' ? 'ğŸ“œ Scripts' : c === 'jobs' ? 'ğŸ’¼ Jobs' : c === 'cars' ? 'ğŸš— Cars' : 'ğŸ—ºï¸ Maps'}
                                    </button>
                                `).join('')}
                            </div>
                        </div>

                        ${filtered.length === 0 ? `
                            <div class="text-center py-20">
                                <div class="text-7xl mb-6">ğŸ“¦</div>
                                <h3 class="text-3xl font-bold text-gray-400">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³ÙƒØ±Ø¨ØªØ§Øª</h3>
                            </div>
                        ` : `
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                ${filtered.map(s => `
                                    <div class="glass rounded-2xl overflow-hidden card-hover cursor-pointer" onclick="viewScript('${s.id}')">
                                        <div class="h-48 bg-gradient-to-br from-purple-900 to-slate-900 relative">
                                            ${s.image ? `
                                                <img src="${s.image}" class="w-full h-full object-cover">
                                            ` : `
                                                <div class="w-full h-full flex items-center justify-center text-6xl">ğŸ“„</div>
                                            `}
                                            <div class="absolute top-3 right-3 bg-black/80 px-3 py-1 rounded-full text-xs font-bold">
                                                ${s.category.toUpperCase()}
                                            </div>
                                        </div>
                                        <div class="p-5">
                                            <h3 class="font-bold text-lg mb-2 line-clamp-1">${s.title}</h3>
                                            <p class="text-gray-400 text-sm mb-4 line-clamp-2">${s.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ'}</p>
                                            <div class="flex justify-between text-sm text-gray-500">
                                                <span>ğŸ‘ï¸ ${s.stats.views}</span>
                                                <span>â¬‡ï¸ ${s.stats.downloads}</span>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        `}
                    `}
                </main>

                <!-- Ù†Ø§ÙØ°Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
                ${state.showAuth ? `
                    <div class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/90">
                        <div class="glass w-full max-w-md rounded-3xl p-10">
                            <h2 class="text-3xl font-black mb-8 text-center gradient-text">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
                            <div class="space-y-4">
                                <input type="email" value="${state.emailForm.email}" oninput="state.emailForm.email=this.value" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" class="w-full bg-slate-900 border border-purple-500/30 rounded-xl p-4 outline-none focus:border-purple-500">
                                <input type="password" value="${state.emailForm.password}" oninput="state.emailForm.password=this.value" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" class="w-full bg-slate-900 border border-purple-500/30 rounded-xl p-4 outline-none focus:border-purple-500">
                                <button onclick="loginUser()" class="w-full btn-primary py-4 rounded-xl font-bold">
                                    Ø¯Ø®ÙˆÙ„
                                </button>
                                <button onclick="state.showAuth=false;render()" class="w-full text-gray-400 text-sm hover:text-white">
                                    Ø¥Ù„ØºØ§Ø¡
                                </button>
                            </div>
                        </div>
                    </div>
                ` : ''}

                <!-- Ù†Ø§ÙØ°Ø© Ø±ÙØ¹ Ø³ÙƒØ±Ø¨Øª -->
                ${state.showUpload ? `
                    <div class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/90 overflow-y-auto">
                        <div class="glass w-full max-w-2xl rounded-3xl p-10 my-auto">
                            <h2 class="text-3xl font-black mb-8 gradient-text">Ø±ÙØ¹ Ø³ÙƒØ±Ø¨Øª Ø¬Ø¯ÙŠØ¯</h2>
                            <div class="space-y-4">
                                <input type="text" value="${state.uploadForm.title}" oninput="state.uploadForm.title=this.value" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø³ÙƒØ±Ø¨Øª" class="w-full bg-slate-900 border border-purple-500/30 rounded-xl p-4 outline-none focus:border-purple-500">
                                
                                <textarea value="${state.uploadForm.description}" oninput="state.uploadForm.description=this.value" placeholder="Ø§Ù„ÙˆØµÙ" class="w-full bg-slate-900 border border-purple-500/30 rounded-xl p-4 h-32 outline-none focus:border-purple-500 resize-none"></textarea>
                                
                                <select onchange="state.uploadForm.category=this.value" class="w-full bg-slate-900 border border-purple-500/30 rounded-xl p-4 outline-none">
                                    <option value="scripts">Scripts</option>
                                    <option value="jobs">Jobs</option>
                                    <option value="cars">Cars</option>
                                    <option value="maps">Maps</option>
                                </select>
                                
                                <div>
                                    <label class="block text-sm text-gray-400 mb-2">Ø§Ù„Ù…Ù„Ù</label>
                                    <input type="file" onchange="handleFileUpload(event)" class="w-full bg-slate-900 border border-purple-500/30 rounded-xl p-3 text-sm">
                                </div>
                                
                                <div>
                                    <label class="block text-sm text-gray-400 mb-2">ØµÙˆØ±Ø© Ù…Ø¹Ø§ÙŠÙ†Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                                    <input type="file" accept="image/*" onchange="handleImageUpload(event)" class="w-full bg-slate-900 border border-purple-500/30 rounded-xl p-3 text-sm">
                                    ${state.uploadForm.image ? `<img src="${state.uploadForm.image}" class="mt-3 w-full h-48 object-cover rounded-xl">` : ''}
                                </div>
                                
                                <div class="flex gap-3">
                                    <button onclick="submitScript()" class="flex-1 btn-primary py-4 rounded-xl font-bold">
                                        Ù†Ø´Ø± Ø§Ù„Ø³ÙƒØ±Ø¨Øª
                                    </button>
                                    <button onclick="state.showUpload=false;state.uploadForm={title:'',description:'',category:'scripts',file:null,image:null};render()" class="px-8 py-4 bg-gray-700 rounded-xl font-bold hover:bg-gray-600">
                                        Ø¥Ù„ØºØ§Ø¡
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                ` : ''}
            `;
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        init();
    </script>
</body>
</html>
